import{aL as Ie,_ as Q,I as ae,s as S,o as a,c as m,b as i,w as o,al as N,am as $e,d as I,z as B,aq as ge,x as f,a$ as Ue,F as _,aH as Ne,a2 as pe,aw as we,V as A,ak as be,ae as R,S as X,J as x,aj as H,a8 as he,aG as Pe,a7 as ie,a as d,L as q,M as K,az as ve,av as me,T as Le,H as ze,D as Oe,a0 as Re,G as Ee,Z as ke}from"./index-dcd728bc.js";import{P as Fe}from"./ProcessDefinition-e2ef86e1.js";import{P as xe}from"./ProcessExecuteDialog-0c343f72.js";import"./hooks.module-fbc9fa96.js";import"./VDataTable-2936e7e3.js";var Ce={exports:{}};(function(e){(function(s){var t=Me(),u=Ae(),g=Be(),n=Ve(),p={imagePlaceholder:void 0,cacheBust:!1},l={toSvg:j,toPng:V,toJpeg:M,toBlob:z,toPixelData:C,impl:{fontFaces:g,images:n,util:t,inliner:u,options:{}}};e.exports=l;function j(h,c){return c=c||{},ye(c),Promise.resolve(h).then(function(y){return _e(y,c.filter,!0)}).then(Se).then(Te).then(b).then(function(y){return je(y,c.width||t.width(h),c.height||t.height(h))});function b(y){return c.bgcolor&&(y.style.backgroundColor=c.bgcolor),c.width&&(y.style.width=c.width+"px"),c.height&&(y.style.height=c.height+"px"),c.style&&Object.keys(c.style).forEach(function(w){y.style[w]=c.style[w]}),y}}function C(h,c){return de(h,c||{}).then(function(b){return b.getContext("2d").getImageData(0,0,t.width(h),t.height(h)).data})}function V(h,c){return de(h,c||{}).then(function(b){return b.toDataURL()})}function M(h,c){return c=c||{},de(h,c).then(function(b){return b.toDataURL("image/jpeg",c.quality||1)})}function z(h,c){return de(h,c||{}).then(t.canvasToBlob)}function ye(h){typeof h.imagePlaceholder>"u"?l.impl.options.imagePlaceholder=p.imagePlaceholder:l.impl.options.imagePlaceholder=h.imagePlaceholder,typeof h.cacheBust>"u"?l.impl.options.cacheBust=p.cacheBust:l.impl.options.cacheBust=h.cacheBust}function de(h,c){return j(h,c).then(t.makeImage).then(t.delay(100)).then(function(y){var w=b(h);return w.getContext("2d").drawImage(y,0,0),w});function b(y){var w=document.createElement("canvas");if(w.width=c.width||t.width(y),w.height=c.height||t.height(y),c.bgcolor){var D=w.getContext("2d");D.fillStyle=c.bgcolor,D.fillRect(0,0,w.width,w.height)}return w}}function _e(h,c,b){if(!b&&c&&!c(h))return Promise.resolve();return Promise.resolve(h).then(y).then(function(v){return w(h,v,c)}).then(function(v){return D(h,v)});function y(v){return v instanceof HTMLCanvasElement?t.makeImage(v.toDataURL()):v.cloneNode(!1)}function w(v,P,O){var J=v.childNodes;if(J.length===0)return Promise.resolve(P);return $(P,t.asArray(J),O).then(function(){return P});function $(oe,F,U){var G=Promise.resolve();return F.forEach(function(se){G=G.then(function(){return _e(se,U)}).then(function(Z){Z&&oe.appendChild(Z)})}),G}}function D(v,P){if(!(P instanceof Element))return P;return Promise.resolve().then(O).then(J).then($).then(oe).then(function(){return P});function O(){F(window.getComputedStyle(v),P.style);function F(U,G){U.cssText?G.cssText=U.cssText:se(U,G);function se(Z,Y){t.asArray(Z).forEach(function(r){Y.setProperty(r,Z.getPropertyValue(r),Z.getPropertyPriority(r))})}}}function J(){[":before",":after"].forEach(function(U){F(U)});function F(U){var G=window.getComputedStyle(v,U),se=G.getPropertyValue("content");if(se===""||se==="none")return;var Z=t.uid();P.className=P.className+" "+Z;var Y=document.createElement("style");Y.appendChild(r(Z,U,G)),P.appendChild(Y);function r(k,T,E){var L="."+k+":"+T,W=E.cssText?ue(E):fe(E);return document.createTextNode(L+"{"+W+"}");function ue(ee){var te=ee.getPropertyValue("content");return ee.cssText+" content: "+te+";"}function fe(ee){return t.asArray(ee).map(te).join("; ")+";";function te(ne){return ne+": "+ee.getPropertyValue(ne)+(ee.getPropertyPriority(ne)?" !important":"")}}}}}function $(){v instanceof HTMLTextAreaElement&&(P.innerHTML=v.value),v instanceof HTMLInputElement&&P.setAttribute("value",v.value)}function oe(){P instanceof SVGElement&&(P.setAttribute("xmlns","http://www.w3.org/2000/svg"),P instanceof SVGRectElement&&["width","height"].forEach(function(F){var U=P.getAttribute(F);U&&P.style.setProperty(F,U)}))}}}function Se(h){return g.resolveAll().then(function(c){var b=document.createElement("style");return h.appendChild(b),b.appendChild(document.createTextNode(c)),h})}function Te(h){return n.inlineAll(h).then(function(){return h})}function je(h,c,b){return Promise.resolve(h).then(function(y){return y.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(y)}).then(t.escapeXhtml).then(function(y){return'<foreignObject x="0" y="0" width="100%" height="100%">'+y+"</foreignObject>"}).then(function(y){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+c+'" height="'+b+'">'+y+"</svg>"}).then(function(y){return"data:image/svg+xml;charset=utf-8,"+y})}function Me(){return{escape:oe,parseExtension:c,mimeType:b,dataAsUrl:$,isDataUrl:y,canvasToBlob:D,resolveUrl:v,getAndEncode:J,uid:P(),delay:F,asArray:U,escapeXhtml:G,makeImage:O,width:se,height:Z};function h(){var r="application/font-woff",k="image/jpeg";return{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:k,jpeg:k,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function c(r){var k=/\.([^\.\/]*?)$/g.exec(r);return k?k[1]:""}function b(r){var k=c(r).toLowerCase();return h()[k]||""}function y(r){return r.search(/^(data:)/)!==-1}function w(r){return new Promise(function(k){for(var T=window.atob(r.toDataURL().split(",")[1]),E=T.length,L=new Uint8Array(E),W=0;W<E;W++)L[W]=T.charCodeAt(W);k(new Blob([L],{type:"image/png"}))})}function D(r){return r.toBlob?new Promise(function(k){r.toBlob(k)}):w(r)}function v(r,k){var T=document.implementation.createHTMLDocument(),E=T.createElement("base");T.head.appendChild(E);var L=T.createElement("a");return T.body.appendChild(L),E.href=k,L.href=r,L.href}function P(){var r=0;return function(){return"u"+k()+r++;function k(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function O(r){return new Promise(function(k,T){var E=new Image;E.onload=function(){k(E)},E.onerror=T,E.src=r})}function J(r){var k=3e4;return l.impl.options.cacheBust&&(r+=(/\?/.test(r)?"&":"?")+new Date().getTime()),new Promise(function(T){var E=new XMLHttpRequest;E.onreadystatechange=ue,E.ontimeout=fe,E.responseType="blob",E.timeout=k,E.open("GET",r,!0),E.send();var L;if(l.impl.options.imagePlaceholder){var W=l.impl.options.imagePlaceholder.split(/,/);W&&W[1]&&(L=W[1])}function ue(){if(E.readyState===4){if(E.status!==200){L?T(L):ee("cannot fetch resource: "+r+", status: "+E.status);return}var te=new FileReader;te.onloadend=function(){var ne=te.result.split(/,/)[1];T(ne)},te.readAsDataURL(E.response)}}function fe(){L?T(L):ee("timeout of "+k+"ms occured while fetching resource: "+r)}function ee(te){console.error(te),T("")}})}function $(r,k){return"data:"+k+";base64,"+r}function oe(r){return r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function F(r){return function(k){return new Promise(function(T){setTimeout(function(){T(k)},r)})}}function U(r){for(var k=[],T=r.length,E=0;E<T;E++)k.push(r[E]);return k}function G(r){return r.replace(/#/g,"%23").replace(/\n/g,"%0A")}function se(r){var k=Y(r,"border-left-width"),T=Y(r,"border-right-width");return r.scrollWidth+k+T}function Z(r){var k=Y(r,"border-top-width"),T=Y(r,"border-bottom-width");return r.scrollHeight+k+T}function Y(r,k){var T=window.getComputedStyle(r).getPropertyValue(k);return parseFloat(T.replace("px",""))}}function Ae(){var h=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:w,shouldProcess:c,impl:{readUrls:b,inline:y}};function c(D){return D.search(h)!==-1}function b(D){for(var v=[],P;(P=h.exec(D))!==null;)v.push(P[1]);return v.filter(function(O){return!t.isDataUrl(O)})}function y(D,v,P,O){return Promise.resolve(v).then(function($){return P?t.resolveUrl($,P):$}).then(O||t.getAndEncode).then(function($){return t.dataAsUrl($,t.mimeType(v))}).then(function($){return D.replace(J(v),"$1"+$+"$3")});function J($){return new RegExp(`(url\\(['"]?)(`+t.escape($)+`)(['"]?\\))`,"g")}}function w(D,v,P){if(O())return Promise.resolve(D);return Promise.resolve(D).then(b).then(function(J){var $=Promise.resolve(D);return J.forEach(function(oe){$=$.then(function(F){return y(F,oe,v,P)})}),$});function O(){return!c(D)}}}function Be(){return{resolveAll:h,impl:{readAll:c}};function h(){return c().then(function(b){return Promise.all(b.map(function(y){return y.resolve()}))}).then(function(b){return b.join(`
`)})}function c(){return Promise.resolve(t.asArray(document.styleSheets)).then(y).then(b).then(function(D){return D.map(w)});function b(D){return D.filter(function(v){return v.type===CSSRule.FONT_FACE_RULE}).filter(function(v){return u.shouldProcess(v.style.getPropertyValue("src"))})}function y(D){var v=[];return D.forEach(function(P){try{t.asArray(P.cssRules||[]).forEach(v.push.bind(v))}catch(O){console.log("Error while reading CSS rules from "+P.href,O.toString())}}),v}function w(D){return{resolve:function(){var P=(D.parentStyleSheet||{}).href;return u.inlineAll(D.cssText,P)},src:function(){return D.style.getPropertyValue("src")}}}}}function Ve(){return{inlineAll:c,impl:{newImage:h}};function h(b){return{inline:y};function y(w){return t.isDataUrl(b.src)?Promise.resolve():Promise.resolve(b.src).then(w||t.getAndEncode).then(function(D){return t.dataAsUrl(D,t.mimeType(b.src))}).then(function(D){return new Promise(function(v,P){b.onload=v,b.onerror=P,b.src=D})})}}function c(b){if(!(b instanceof Element))return Promise.resolve(b);return y(b).then(function(){return b instanceof HTMLImageElement?h(b).inline():Promise.all(t.asArray(b.childNodes).map(function(w){return c(w)}))});function y(w){var D=w.style.getPropertyValue("background");return D?u.inlineAll(D).then(function(v){w.style.setProperty("background",v,w.style.getPropertyPriority("background"))}).then(function(){return w}):Promise.resolve(w)}}}})()})(Ce);var He=Ce.exports;const Ge=Ie(He),Ze={props:{process:Object,enableEdit:Boolean,type:String,processDialogStatus:Boolean,processType:String,subProcessDialogStauts:Boolean},data:()=>({newProcess:{label:""},isNewDef:!1,definitions:null}),mounted(){this.processDialogStatus&&(this.processType=="add"||this.processType=="update"&&(this.newProcess.id=this.process.id,this.newProcess.label=this.process.label))},computed:{addType(){if(this.type=="map")return"mega";if(this.type=="mega")return"major";if(this.type=="major")return"sub"}},watch:{isNewDef(e){},processDialogStatus(e){e&&(this.processType=="add"||this.processType=="update"&&(this.newProcess.id=this.process.id,this.newProcess.label=this.process.label))}},created(){this.init()},methods:{async init(){const e=ae.createBackend();if(this.addType=="sub"){const s=await e.listDefinition();s&&s.length>0?this.definitions=s:this.definitions=null}},closeDialog(){this.isNewDef=!1,this.$emit("closeProcessDialog")},addProcess(){this.newProcess.label!=""&&(this.$emit("add",this.newProcess),this.addType==="sub"&&this.closeDialog())},updateProcess(){this.newProcess.id!=""&&(this.$emit("edit",this.newProcess),this.closeDialog())}}},Xe={key:0},qe=I("저장"),Ke=I("닫기"),Je={key:0},We={"max-width":"500"};function Qe(e,s,t,u,g,n){const p=S("Icon");return t.enableEdit?(a(),m("div",Xe,[i(be,{modelValue:t.subProcessDialogStauts,"onUpdate:modelValue":s[4]||(s[4]=l=>t.subProcessDialogStauts=l),"max-width":"500"},{default:o(()=>[i(N,null,{default:o(()=>[i($e,null,{default:o(()=>[I(B(n.addType.toUpperCase())+" 프로세스 추가 ",1)]),_:1}),i(ge,null,{default:o(()=>[n.addType=="sub"&&!e.isNewDef&&e.definitions?(a(),f(Ue,{key:0,modelValue:e.newProcess,"onUpdate:modelValue":s[0]||(s[0]=l=>e.newProcess=l),items:e.definitions,label:"프로세스 정의","item-title":"name","return-object":""},null,8,["modelValue","items"])):_("",!0),n.addType=="sub"?(a(),f(Ne,{key:1,modelValue:e.isNewDef,"onUpdate:modelValue":s[1]||(s[1]=l=>e.isNewDef=l),class:"cp-custom-sub",label:"새로운 프로세스 정의 추가",color:"primary",density:"compact"},null,8,["modelValue"])):_("",!0),n.addType!="sub"||e.isNewDef?(a(),f(pe,{key:2,modelValue:e.newProcess.label,"onUpdate:modelValue":s[2]||(s[2]=l=>e.newProcess.label=l),class:"cp-process-name",label:"프로세스명"},null,8,["modelValue"])):_("",!0)]),_:1}),i(we,{class:"justify-center"},{default:o(()=>[i(A,{color:"primary",variant:"flat",class:"cp-process-save",disabled:e.newProcess.id==""&&e.newProcess.label=="",onClick:n.addProcess},{default:o(()=>[qe]),_:1},8,["disabled","onClick"]),i(A,{color:"error",variant:"flat",onClick:s[3]||(s[3]=l=>n.closeDialog())},{default:o(()=>[Ke]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.processType==="add"&&!t.subProcessDialogStauts?(a(),m("div",Je,[i(H,{class:"ma-0 pa-0",align:"center"},{default:o(()=>[i(R,{class:"ma-0 pa-0",cols:"12"},{default:o(()=>[n.addType=="sub"&&!e.isNewDef?(a(),f(H,{key:0,justify:"end",class:"ma-0 pa-0"},{default:o(()=>[i(X,{text:"닫기"},{activator:o(({props:l})=>[i(A,x({onClick:s[5]||(s[5]=j=>n.closeDialog()),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"material-symbols:close"})]),_:2},1040)]),_:1})]),_:1})):_("",!0)]),_:1})]),_:1}),e.isNewDef||n.addType==="mega"||n.addType==="major"?(a(),f(H,{key:0,justify:"end",class:"ma-0 pa-0",style:{"margin-top":"-22px !important"}},{default:o(()=>[i(he),i(X,{text:"닫기"},{activator:o(({props:l})=>[i(A,x({onClick:s[6]||(s[6]=j=>n.closeDialog()),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"material-symbols:close"})]),_:2},1040)]),_:1}),i(R,{cols:"12",class:"ma-0 pa-0"},{default:o(()=>[i(pe,{class:"cp-process-id",modelValue:e.newProcess.label,"onUpdate:modelValue":s[7]||(s[7]=l=>e.newProcess.label=l),label:`${n.addType.toUpperCase()} 프로세스 추가`,autofocus:"",onKeypress:Pe(n.addProcess,["enter"]),onClick:s[8]||(s[8]=ie(()=>{},["stop"]))},null,8,["modelValue","label","onKeypress"])]),_:1})]),_:1})):_("",!0)])):_("",!0),t.processType==="update"?(a(),f(H,{key:1,justify:"end",class:"ma-0 pa-0"},{default:o(()=>[i(he),i(X,{text:"닫기"},{activator:o(({props:l})=>[i(A,x({onClick:s[9]||(s[9]=ie(j=>n.closeDialog(),["stop"])),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"material-symbols:close"})]),_:2},1040)]),_:1}),i(R,{cols:"12",class:"ma-0 pa-0"},{default:o(()=>[d("div",We,[i(pe,{class:"edit-process-text-field",modelValue:e.newProcess.label,"onUpdate:modelValue":s[10]||(s[10]=l=>e.newProcess.label=l),autofocus:"",label:"프로세스 수정",onKeypress:Pe(n.updateProcess,["enter"]),onClick:s[11]||(s[11]=ie(()=>{},["stop"]))},null,8,["modelValue","onKeypress"])])]),_:1})]),_:1})):_("",!0)])):_("",!0)}const le=Q(Ze,[["render",Qe]]),Ye={components:{ProcessDialog:le},props:{size:Number,type:String,process:Object,enableEdit:Boolean},data:()=>({newProcess:{id:"",label:""},processDialogStatus:!1,processType:""}),computed:{addType(){if(this.type=="map")return"mega";if(this.type=="mega")return"major";if(this.type=="major")return"sub"}},watch:{},created(){},methods:{openEditDialog(e){this.$emit("editProcessdialog",e)},deleteProcess(){this.$emit("delete")},editProcess(){this.$emit("modeling")}}},et={key:0,class:"proc-menu-btn-box"};function tt(e,s,t,u,g,n){const p=S("Icon");return a(),m("div",null,[i(H,{class:"ma-0 pa-0"},{default:o(()=>[i(he),t.enableEdit?(a(),m("div",et,[t.type=="sub"?(a(),f(X,{key:0,text:"프로세스 편집"},{activator:o(({props:l})=>[i(A,x({onClick:ie(n.editProcess,["stop"]),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"tabler:pencil-cog",width:"16",height:"16"})]),_:2},1040,["onClick"])]),_:1})):_("",!0),t.type!="map"?(a(),f(X,{key:1,text:"수정"},{activator:o(({props:l})=>[i(A,x({onClick:s[0]||(s[0]=ie(j=>n.openEditDialog("update"),["stop"])),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"oi:pencil"})]),_:2},1040)]),_:1})):_("",!0),t.type!="map"?(a(),f(X,{key:2,text:"삭제"},{activator:o(({props:l})=>[i(A,x({onClick:ie(n.deleteProcess,["stop"]),icon:""},l,{density:"compact",size:"small"}),{default:o(()=>[i(p,{icon:"el:trash"})]),_:2},1040,["onClick"])]),_:1})):_("",!0)])):_("",!0)]),_:1})])}const re=Q(Ye,[["render",tt]]),st={components:{},props:{},data:()=>({processDialogStatus:!1,hover:!1}),methods:{async editProcess(e){this.value.id=e.id,this.value.label=e.label},editProcessdialog(e){this.processType=e,this.processDialogStatus=!0},openProcessDialog(e){this.processType=e,this.processDialogStatus=!0},closeProcessDialog(){this.processDialogStatus=!1},goProcess(e,s){if(!e&&!s)this.$router.push("/definition-map");else{const t=encodeURIComponent(e);this.$router.push(`/definition-map/${s}/${t}`)}}}};function ot(e,s,t,u,g,n){return a(),m("div")}const ce=Q(st,[["render",ot]]);const it={components:{ProcessMenu:re,ProcessDialog:le},mixins:[ce],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"sub",definition:null}),async created(){},methods:{deleteProcess(){this.parent.sub_proc_list=this.parent.sub_proc_list.filter(e=>e.id!=this.value.id)},async editProcessModel(){const e=ae.createBackend();this.definition=await e.getRawDefinition(this.value.id);let s;this.definition&&this.definition.id?s=`/definitions/${this.definition.id}`:s=`/definitions/chat?id=${this.value.id}&name=${this.value.label}`,window.open(s,"_blank")}}},at={key:0,class:"text-subtitle-2 font-weight-semibold"},nt={class:"ml-auto add-sub-process"};function lt(e,s,t,u,g,n){const p=S("ProcessMenu"),l=S("ProcessDialog");return a(),m("div",{class:"align-center pa-2 cursor-pointer sub-process-hover sub-process-style pr-3 pl-3",onClick:s[0]||(s[0]=j=>e.goProcess(t.value.id,"sub"))},[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",at,[i(H,{class:"ma-0 pa-0"},{default:o(()=>[i(R,{cols:t.enableEdit?"6":"12",class:"ma-0 pa-0 text-left align-center"},{default:o(()=>[d("div",null,B(t.value.label),1)]),_:1},8,["cols"]),i(R,{cols:t.enableEdit?"6":"",class:"ma-0 pa-0"},{default:o(()=>[d("div",nt,[i(p,{size:16,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog,onModeling:n.editProcessModel},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog","onModeling"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),f(l,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):_("",!0)])}const rt=Q(it,[["render",lt],["__scopeId","data-v-c9da90fd"]]),ct={components:{ProcessMenu:re,SubProcess:rt,ProcessDialog:le},mixins:[ce],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"major",subProcessDialogStauts:!1}),methods:{async addProcess(e){e.id||(e.id=`${this.parent.label}_${e.label}`),e.id=e.id.replace(/[/.]/g,"_");var s={id:e.id,label:e.name?e.name:e.label};this.value.sub_proc_list.push(s)},openSubProcessDialog(e){this.processType=e,this.processDialogStatus=!0,this.subProcessDialogStauts=!0},deleteProcess(){this.parent.major_proc_list=this.parent.major_proc_list.filter(e=>e.id!=this.value.id)}}},dt={key:0,class:"text-subtitle-1 font-weight-semibold"},ut={class:"ml-auto add-major-process"},ft={key:1};function pt(e,s,t,u,g,n){const p=S("ProcessMenu"),l=S("ProcessDialog"),j=S("SubProcess"),C=S("draggable"),V=S("PlusIcon");return a(),m("div",{class:"mb-3",onMouseover:s[2]||(s[2]=M=>e.hover=!0),onMouseleave:s[3]||(s[3]=M=>e.hover=!1)},[i(N,{class:"align-center bg-lightsecondary pa-2 pr-3 pl-3",elevation:"10",style:{"border-radius":"10px !important","margin-bottom":"5px"},onClick:s[0]||(s[0]=M=>e.goProcess(t.parent.label,"mega"))},{default:o(()=>[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",dt,[i(H,{class:"ma-0 pa-0"},{default:o(()=>[i(R,{cols:t.enableEdit?"8":"12",class:"ma-0 pa-0 text-left"},{default:o(()=>[d("div",null,B(t.value.label),1)]),_:1},8,["cols"]),i(R,{cols:t.enableEdit?"4":"",class:"ma-0 pa-0"},{default:o(()=>[d("div",ut,[i(p,{size:16,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),f(l,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):_("",!0)]),_:1}),t.enableEdit?(a(),f(C,{key:0,class:"dragArea list-group",list:t.value.sub_proc_list,animation:200,"ghost-class":"ghost-card",group:"subProcess"},{default:o(()=>[i(ve,null,{default:o(()=>[(a(!0),m(q,null,K(t.value.sub_proc_list,M=>(a(),m("div",{key:M.id,class:"cursor-pointer"},[i(j,{value:M,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]))),128))]),_:1})]),_:1},8,["list"])):(a(),m("div",ft,[(a(!0),m(q,null,K(t.value.sub_proc_list,M=>(a(),m("div",{key:M.id},[i(j,{value:M,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]))),128))])),!e.processDialogStatus&&t.enableEdit&&e.hover?(a(),f(N,x({key:2,onClick:s[1]||(s[1]=M=>n.openSubProcessDialog("add")),class:"add-process-card-hover cp-add-mega",elevation:"9",variant:"outlined"},e.props,{style:{display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important",height:"26px"}}),{default:o(()=>[i(H,{class:"pa-0 ma-0 definitionMap-add-card"},{default:o(()=>[i(V,{size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addSub")),1)]),_:1})]),_:1},16)):e.processDialogStatus&&t.enableEdit&&e.processType==="add"?(a(),f(l,{key:3,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,subProcessDialogStauts:e.subProcessDialogStauts,processType:e.processType,type:e.type,onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog,style:{"margin-top":"20px !important"}},null,8,["enableEdit","process","processDialogStatus","subProcessDialogStauts","processType","type","onAdd","onCloseProcessDialog"])):_("",!0)],32)}const mt=Q(ct,[["render",pt]]),ht={components:{ProcessMenu:re,MajorProcess:mt,ProcessDialog:le},mixins:[ce],props:{value:Object,parent:Object,enableEdit:Boolean},data:()=>({type:"mega",hover:!1}),created(){},methods:{addProcess(e){let s=0;this.value.major_proc_list.length!=0&&(s=this.value.major_proc_list[this.value.major_proc_list.length-1].id+1);var t={id:s,label:e.label,sub_proc_list:[]};this.value.major_proc_list.push(t)},deleteProcess(){this.parent.mega_proc_list=this.parent.mega_proc_list.filter(e=>e.id!=this.value.id)}}},gt={key:0,class:"text-h6 font-weight-semibold"},bt={class:"ml-auto add-major-process"},vt={key:1};function yt(e,s,t,u,g,n){const p=S("ProcessMenu"),l=S("ProcessDialog"),j=S("MajorProcess"),C=S("draggable"),V=S("PlusIcon");return a(),m("div",{class:"w-100",onMouseover:s[2]||(s[2]=M=>e.hover=!0),onMouseleave:s[3]||(s[3]=M=>e.hover=!1)},[i(N,{class:"align-center pa-3 mb-3 bg-lightwarning",elevation:"10",style:{"border-radius":"10px !important"},onClick:s[0]||(s[0]=M=>e.goProcess(t.value.label,"mega"))},{default:o(()=>[!e.processDialogStatus||e.processType==="add"?(a(),m("h6",gt,[i(H,{class:"ma-0 pa-0"},{default:o(()=>[i(R,{cols:t.enableEdit?"8":"12",class:"ma-0 pa-0 text-left"},{default:o(()=>[d("div",null,B(t.value.label),1)]),_:1},8,["cols"]),i(R,{cols:t.enableEdit?"4":"",class:"ma-0 pa-0"},{default:o(()=>[d("div",bt,[i(p,{size:20,type:e.type,process:t.value,enableEdit:t.enableEdit,onDelete:n.deleteProcess,onEditProcessdialog:e.editProcessdialog},null,8,["type","process","enableEdit","onDelete","onEditProcessdialog"])])]),_:1},8,["cols"])]),_:1})])):e.processDialogStatus&&t.enableEdit&&e.processType==="update"?(a(),f(l,{key:1,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onEdit:e.editProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","processDialogStatus","processType","type","onEdit","onCloseProcessDialog"])):_("",!0)]),_:1}),t.enableEdit?(a(),f(C,{key:0,class:"dragArea list-group",list:t.value.major_proc_list,animation:200,"ghost-class":"ghost-card",group:"majorProcess"},{default:o(()=>[i(ve,null,{default:o(()=>[(a(!0),m(q,null,K(t.value.major_proc_list,M=>(a(),m("div",{key:M.id,class:"cursor-pointer"},[i(j,{value:M,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]))),128))]),_:1})]),_:1},8,["list"])):(a(),m("div",vt,[(a(!0),m(q,null,K(t.value.major_proc_list,M=>(a(),m("div",{key:M.id},[i(j,{value:M,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]))),128))])),!e.processDialogStatus&&t.enableEdit&&e.hover?(a(),f(N,{key:2,onClick:s[1]||(s[1]=M=>e.openProcessDialog("add")),class:"add-process-card-hover bg-lightsecondary cp-add-mega pa-2",elevation:"9",variant:"outlined",style:{display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important",height:"34px"}},{default:o(()=>[i(H,{class:"pa-0 ma-0 definitionMap-add-card"},{default:o(()=>[i(V,{size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addMajor")),1)]),_:1})]),_:1})):e.processDialogStatus&&t.enableEdit&&e.processType==="add"?(a(),f(l,{key:3,enableEdit:t.enableEdit,process:t.value,processDialogStatus:e.processDialogStatus,processType:e.processType,type:e.type,onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog,style:{"margin-top":"20px !important"}},null,8,["enableEdit","process","processDialogStatus","processType","type","onAdd","onCloseProcessDialog"])):_("",!0)],32)}const _t=Q(ht,[["render",yt]]);const Pt={components:{MegaProcess:_t,ProcessDialog:le},mixins:[ce],props:{value:Object,enableEdit:Boolean},data:()=>({processType:"",processRenderer:0}),methods:{addProcess(e){let s=0;this.value.mega_proc_list.length!=0&&(s=this.value.mega_proc_list[this.value.mega_proc_list.length-1].id+1);var t={id:s,label:e.label,major_proc_list:[]};this.value.mega_proc_list.push(t)}}},kt={class:"pa-5"};function Dt(e,s,t,u,g,n){const p=S("MegaProcess"),l=S("PlusIcon"),j=S("ProcessDialog"),C=S("draggable");return a(),m("div",kt,[t.enableEdit?(a(),f(C,{key:0,class:"v-row dragArea list-group",list:t.value.mega_proc_list,animation:200,"ghost-class":"ghost-card",group:"megaProcess",draggable:".draggable-item"},{default:o(()=>[i(ve,null,{default:o(()=>[(a(!0),m(q,null,K(t.value.mega_proc_list,V=>(a(),f(R,{key:V.id,class:"cursor-pointer draggable-item",cols:"12",md:"2",sm:"6"},{default:o(()=>[i(p,{value:V,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]),_:2},1024))),128)),i(R,{class:"cursor-pointer",cols:"12",md:"2",sm:"3"},{default:o(()=>[e.processDialogStatus?_("",!0):(a(),f(N,{key:0,onClick:s[0]||(s[0]=V=>e.openProcessDialog("add")),class:"add-process-card-hover bg-lightwarning cp-add-mega",elevation:"9",variant:"outlined",style:{padding:"10px",display:"flex","justify-content":"center","align-items":"center","border-radius":"10px !important"}},{default:o(()=>[i(H,{class:"pa-0 ma-0 definitionMap-add-card"},{default:o(()=>[i(l,{size:"20","stroke-width":"2"}),d("div",null," "+B(e.$t("processDefinitionMap.addMega")),1)]),_:1})]),_:1})),e.processDialogStatus?(a(),f(j,{key:1,enableEdit:t.enableEdit,process:t.value,definitions:e.definitions,processType:e.processType,type:"map",onAdd:n.addProcess,onCloseProcessDialog:e.closeProcessDialog},null,8,["enableEdit","process","definitions","processType","onAdd","onCloseProcessDialog"])):_("",!0)]),_:1})]),_:1})]),_:1},8,["list","draggable"])):(a(),f(H,{key:1},{default:o(()=>[(a(!0),m(q,null,K(t.value.mega_proc_list,V=>(a(),f(R,{key:V.id,class:"cursor-pointer",cols:"12",md:"2",sm:"6"},{default:o(()=>[i(p,{value:V,parent:t.value,enableEdit:t.enableEdit},null,8,["value","parent","enableEdit"])]),_:2},1024))),128))]),_:1}))])}const wt=Q(Pt,[["render",Dt]]),Et={components:{ProcessDefinition:Fe,ProcessExecuteDialog:xe},mixins:[ce],props:{value:Object,enableEdit:Boolean},data:()=>({onLoad:!1,bpmn:null,processDefinition:null,selectedProc:{mega:null,major:null},selectedSubProcess:null,subProcessBreadCrumb:[],defCnt:0,isViewMode:!0,executeDialog:!1}),watch:{"$route.params":{handler(e,s){e.id!==s.id&&this.init(e)}}},created(){this.init(this.$route.params)},methods:{goHistory(e){this.updateBpmn(this.subProcessBreadCrumb[e].xml),this.removeHistoryAfterIndex(e)},removeHistoryAfterIndex(e){if(e<0||e>=this.subProcessBreadCrumb.length){console.error("Invalid index");return}this.subProcessBreadCrumb.splice(e+1)},updateBpmn(e){this.bpmn=e,this.defCnt++},async openSubProcess(e){var t,u;let s=this;if((u=(t=e.extensionElements)==null?void 0:t.values[0])!=null&&u.definition){const g=ae.createBackend(),n=e.extensionElements.values[0].definition,p=await g.getRawDefinition(n,null);if(p){let l={processName:e.extensionElements.values[0].definition,xml:p.bpmn};s.subProcessBreadCrumb.push(l),s.selectedSubProcess=e.extensionElements.values[0].definition,s.updateBpmn(p.bpmn)}}},async init(e){var s=this;s.$try({action:async()=>{s.onLoad=!1;const t=e.id,u=ae.createBackend();let g;s.value&&s.value.mega_proc_list&&s.value.mega_proc_list.length>0?g=s.value:g=await u.getProcessDefinitionMap(),g.mega_proc_list.forEach(p=>{p.major_proc_list.forEach(l=>{l.sub_proc_list.forEach(j=>{j.id==t&&(e=j,this.selectedProc.mega=p,this.selectedProc.major=l)})})});const n=await u.getRawDefinition(t,null);n&&!n.code?(this.processDefinition=n,this.bpmn=n.bpmn):(this.processDefinition=e,this.bpmn=null),s.onLoad=!0}})},editProcessModel(){this.processDefinition&&this.processDefinition.id&&this.$router.push(`/definitions/chat?id=${this.processDefinition.id}&name=${this.processDefinition.label}`)},capture(){this.$emit("capture")},executeProcess(){this.executeDialog=!0}}},Ct={class:"pa-2 d-flex align-center"},St={class:"text-h6 font-weight-semibold"},Tt=I("mdi-chevron-right"),jt={class:"text-h6 font-weight-semibold"},Mt=I("mdi-chevron-right"),At={class:"text-h6 font-weight-semibold"},Bt=["onClick"],Vt=I("mdi-chevron-right"),It={class:"text-h6 font-weight-semibold"},$t={class:"ml-auto d-flex"},Ut={key:0},Nt={key:1,style:{height:"90%","text-align":"center"}},Lt=d("h6",{class:"text-h6"},"정의된 프로세스 모델이 없습니다.",-1),zt=I(" 프로세스 편집 "),Ot={key:2};function Rt(e,s,t,u,g,n){const p=S("Icon"),l=S("ProcessDefinition"),j=S("ProcessExecuteDialog");return a(),f(N,{elevation:"10",style:Ee(e.$globalState.state.isZoomed?"height: 100vh":"height:calc(100vh - 155px);")},{default:o(()=>[d("div",Ct,[e.selectedProc.mega?(a(),m("div",{key:0,class:"d-flex align-center cursor-pointer",onClick:s[0]||(s[0]=C=>e.goProcess())},[d("h6",St,B(e.selectedProc.mega.label),1),i(me,null,{default:o(()=>[Tt]),_:1})])):_("",!0),e.selectedProc.major?(a(),m("div",{key:1,class:"d-flex align-center cursor-pointer",onClick:s[1]||(s[1]=C=>e.goProcess(e.selectedProc.mega.label,"mega"))},[d("h6",jt,B(e.selectedProc.major.label),1),d("div",null,[i(me,{class:"cursor-pointer"},{default:o(()=>[Mt]),_:1}),i(Re,{activator:"parent"},{default:o(()=>[e.selectedProc.major.sub_proc_list?(a(),f(Le,{key:0,density:"compact",class:"cursor-pointer"},{default:o(()=>[(a(!0),m(q,null,K(e.selectedProc.major.sub_proc_list,C=>(a(),f(ze,{key:C.id,onClick:V=>e.goProcess(C.id,"sub")},{default:o(()=>[i(Oe,null,{default:o(()=>[I(B(C.label),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):_("",!0)]),_:1})])])):_("",!0),e.processDefinition?(a(),m("div",{key:2,class:"d-flex align-center",onClick:s[2]||(s[2]=C=>{n.updateBpmn(e.processDefinition.bpmn),e.subProcessBreadCrumb=[]})},[d("h6",At,B(e.processDefinition&&e.processDefinition.name?e.processDefinition.name:e.processDefinition.label),1)])):_("",!0),(a(!0),m(q,null,K(e.subProcessBreadCrumb,(C,V)=>(a(),m("div",{key:V},[d("div",{class:"d-flex align-center",onClick:M=>n.goHistory(V)},[i(me,null,{default:o(()=>[Vt]),_:1}),d("h6",It,B(C.processName),1)],8,Bt)]))),128)),d("div",$t,[e.onLoad&&e.bpmn?(a(),m("div",Ut,[i(A,{icon:"",variant:"text",class:"ml-3",size:24,onClick:n.executeProcess},{default:o(()=>[i(p,{icon:"carbon:play-outline",width:"24",height:"24"})]),_:1},8,["onClick"]),i(A,{icon:"",variant:"text",class:"ml-3",size:24,onClick:n.capture},{default:o(()=>[i(p,{icon:"mage:image-download",width:"24",height:"24"})]),_:1},8,["onClick"])])):_("",!0),i(X,{text:e.$t("processDefinition.zoom")},{activator:o(({props:C})=>[i(A,x({size:30,icon:"",variant:"text",class:"ml-3"},C,{onClick:s[3]||(s[3]=V=>e.$globalState.methods.toggleZoom())}),{default:o(()=>[e.$globalState.state.isZoomed?(a(),f(p,{key:1,icon:"material-symbols:zoom-in-map-rounded",width:"24",height:"24"})):(a(),f(p,{key:0,icon:"material-symbols:zoom-out-map-rounded",width:"24",height:"24"}))]),_:2},1040)]),_:1},8,["text"])])]),i(ge,{style:{width:"100%",height:"95%",padding:"10px"}},{default:o(()=>[e.onLoad&&e.bpmn?(a(),f(l,{style:{width:"100%",height:"100%"},bpmn:e.bpmn,key:e.defCnt,processDefinition:e.processDefinition.definition,isViewMode:e.isViewMode,onOpenSubProcess:s[4]||(s[4]=C=>n.openSubProcess(C))},null,8,["bpmn","processDefinition","isViewMode"])):e.onLoad&&!e.bpmn?(a(),m("div",Nt,[Lt,t.enableEdit?(a(),f(A,{key:0,color:"primary",variant:"flat",class:"mt-4",onClick:n.editProcessModel},{default:o(()=>[zt]),_:1},8,["onClick"])):_("",!0)])):(a(),m("div",Ot))]),_:1}),i(be,{modelValue:e.executeDialog,"onUpdate:modelValue":s[6]||(s[6]=C=>e.executeDialog=C)},{default:o(()=>[i(j,{definitionId:e.processDefinition.id,onClose:s[5]||(s[5]=C=>e.executeDialog=!1)},null,8,["definitionId"])]),_:1},8,["modelValue"])]),_:1},8,["style"])}const Ft=Q(Et,[["render",Rt]]);const xt={components:{ProcessMenu:re},props:{value:Object,enableEdit:Boolean},data(){return{processPath:null,filteredProcess:{id:"",label:"",major_proc_list:[]},onLoad:!1}},created(){this.init(this.$route.params)},watch:{value(e){if(e&&e.mega_proc_list&&e.mega_proc_list.length>0){const s=e.mega_proc_list.find(t=>t.label===this.processPath);s&&(this.filteredProcess=s)}}},methods:{init(e){var s=this;s.$try({action:async()=>{s.onLoad=!1,s.processPath=e.id;let t;s.value&&s.value.mega_proc_list&&s.value.mega_proc_list.length>0?t=s.value:t=await ae.createBackend().getProcessDefinitionMap();const u=t.mega_proc_list.find(g=>g.label===s.processPath);u&&(s.filteredProcess=u),s.onLoad=!0}})},addProcess(e,s,t){if(s==="mega")this.filteredProcess.major_proc_list||(this.filteredProcess.major_proc_list=[]),this.filteredProcess.major_proc_list.push({id:e.id,label:e.label,sub_proc_list:[]});else if(s==="major"){const u=this.filteredProcess.major_proc_list.find(g=>g.label===t);u?(u.sub_proc_list||(u.sub_proc_list=[]),u.sub_proc_list.push({id:e.id,label:e.label})):console.error("Major process not found for the given selectedProcessId")}},editProcess(e,s,t){if(s==="mega"){let u=this.value.mega_proc_list.find(g=>g.id===t);u&&(u.id=e.id,u.label=e.label,this.processPath=e.label)}else s==="major"?this.value.mega_proc_list.forEach(u=>{let g=u.major_proc_list.find(n=>n.id===t);g&&(g.id=e.id,g.label=e.label)}):s==="sub"&&this.value.mega_proc_list.forEach(u=>{u.major_proc_list.forEach(g=>{let n=g.sub_proc_list.find(p=>p.id===t);n&&(n.id=e.id,n.label=e.label)})})},deleteProcess(e,s){e==="mega"?this.value.mega_proc_list=this.value.mega_proc_list.filter(t=>t.id!==s):e==="major"?this.value.mega_proc_list.forEach(t=>{t.major_proc_list=t.major_proc_list.filter(u=>u.id!==s)}):e==="sub"&&this.value.mega_proc_list.forEach(t=>{t.major_proc_list.forEach(u=>{u.sub_proc_list=u.sub_proc_list.filter(g=>g.id!==s)})})},viewProcess(e){this.$router.push(`/definition-map/sub/${e.id}`)}}},Ht={key:0},Gt={class:"d-flex align-items-center"},Zt=d("div",{class:"d-flex flex-column justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[I(" Mega"),d("br"),I("Process ")])],-1),Xt=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),qt={class:"text-h6 font-weight-semibold text-center"},Kt={key:0,class:"d-flex align-items-center"},Jt=d("div",{class:"d-flex flex-column justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[I(" Major"),d("br"),I("Process ")])],-1),Wt=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),Qt={class:"d-flex flex-column justify-content-center align-items-center"},Yt={class:"text-h6 font-weight-semibold text-center"},es={key:1,class:"d-flex align-items-center"},ts=d("div",{class:"justify-content-center align-items-center"},[d("h6",{class:"text-h6 font-weight-semibold text-center"},[I(" Sub"),d("br"),I("Process ")])],-1),ss=d("div",{class:"line-with-dots d-flex"},[d("div",{class:"dot"}),d("div",{class:"line flex-grow-1"}),d("div",{class:"dot"})],-1),os={class:"d-flex flex-column justify-content-center align-items-center"},is={class:"text-h6 font-weight-semibold text-center"};function as(e,s,t,u,g,n){return g.onLoad?(a(),m("div",Ht,[d("div",Gt,[i(N,{class:"d-flex justify-center align-center pa-3 mb-3 bg-lightwarning details-title-card",elevation:"10"},{default:o(()=>[Zt]),_:1}),Xt,i(N,{class:"d-flex align-center pa-3 mb-3 bg-lightwarning",elevation:"10",style:{"border-radius":"10px !important"}},{default:o(()=>[d("h6",qt,B(g.filteredProcess.label),1)]),_:1})]),g.filteredProcess&&g.filteredProcess.major_proc_list&&g.filteredProcess.major_proc_list.length>0?(a(),m("div",Kt,[i(N,{class:"d-flex justify-center align-center pa-3 mb-3 details-title-card bg-lightsecondary",elevation:"10"},{default:o(()=>[Jt]),_:1}),Wt,(a(!0),m(q,null,K(g.filteredProcess.major_proc_list,(p,l)=>(a(),f(N,{key:l,class:"d-flex align-center pa-3 mb-3 bg-lightsecondary last-no-margin",elevation:"10",style:{"border-radius":"10px !important"}},{default:o(()=>[d("div",Qt,[d("h6",Yt,B(p.label),1)])]),_:2},1024))),128))])):_("",!0),g.filteredProcess&&g.filteredProcess.major_proc_list&&g.filteredProcess.major_proc_list.some(p=>p.sub_proc_list&&p.sub_proc_list.length>0)?(a(),m("div",es,[i(N,{class:"d-flex justify-center align-center pa-3 mb-3 bg-white details-title-card",elevation:"10"},{default:o(()=>[ts]),_:1}),ss,(a(!0),m(q,null,K(g.filteredProcess.major_proc_list,(p,l)=>(a(),f(R,{key:l,class:"ma-0 pa-0 last-no-margin"},{default:o(()=>[(a(!0),m(q,null,K(p.sub_proc_list,(j,C)=>(a(),f(N,{key:`sub-${l}-${C}`,class:"d-flex align-center pa-3 mb-3 bg-white",elevation:"10",style:{"border-radius":"10px !important",cursor:"pointer"},onClick:V=>n.viewProcess(j)},{default:o(()=>[d("div",os,[d("h6",is,B(j.label),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))])):_("",!0)])):_("",!0)}const ns=Q(xt,[["render",as]]),De=ae.createBackend(),ls={components:{ProcessMenu:re,ViewProcessDetails:ns,SubProcessDetail:Ft,DefinitionMapList:wt},props:{componentName:{type:String,required:!0}},data:()=>({storage:null,value:{mega_proc_list:[]},type:"map",enableEdit:!1,userName:null,lock:null,editUser:null,alertType:"",alertDialog:!1,alertMessage:"",isAdmin:!1,versionHistory:[]}),computed:{useLock(){return window.$mode=="ProcessGPT"}},async created(){var e=this;e.$try({action:async()=>{e.userName=localStorage.getItem("userName"),localStorage.getItem("isAdmin")=="true"&&(e.isAdmin=!0),await e.getProcessMap(),e.useLock&&await e.checkedLock()}})},beforeRouteLeave(e,s,t){this.lock&&this.enableEdit?this.openAlertDialog().then(u=>{u?t():t(!1)}):t()},methods:{async checkedLock(){if(this.isAdmin){this.enableEdit=!1,this.storage=ke.getStorage();const e=await this.storage.getObject("lock",{match:{id:"process-map"}});e&&e.id&&e.user_id?(this.lock=!0,this.editUser=e.user_id,this.userName==this.editUser&&(this.enableEdit=!0)):this.lock=!1}},capturePng(){var e=document.getElementById("processMap");Ge.toPng(e).then(function(s){const t=document.createElement("a");t.href=s,t.download="processMap.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}).catch(function(s){console.error("oops, something went wrong!",s)})},goProcessMap(){this.$router.push("/definition-map")},async getProcessMap(){let e=await De.getProcessDefinitionMap();e.mega_proc_list?this.value=e:this.value={mega_proc_list:[]}},addProcess(e){var s={id:e.id,label:e.label,major_proc_list:[]};this.value.mega_proc_list.push(s)},async saveProcess(){await De.putProcessDefinitionMap(this.value),this.closeAlertDialog()},async checkIn(){this.lock=!1,this.enableEdit=!1,this.userName==this.editUser&&await this.saveProcess(),this.useLock&&await this.storage.delete("lock/process-map",{key:"id"}),this.closeAlertDialog()},async checkOut(){if(this.lock=!0,this.enableEdit=!0,this.closeAlertDialog(),this.useLock&&this.userName&&this.userName!=null){this.editUser=this.userName;let e={id:"process-map",user_id:this.editUser};await this.storage.putObject("lock",e)}},async openAlertDialog(){return new Promise(async e=>{if(this.isAdmin){this.storage=ke.getStorage();const s=await this.storage.getObject("lock/process-map",{key:"id"});s&&s.id&&s.user_id?(this.lock=!0,this.editUser=s.user_id,this.editUser==this.userName?(this.alertDialog=!0,this.alertMessage="수정된 내용을 저장 및 체크인 하시겠습니까?"):(this.alertDialog=!0,this.alertMessage=`현재 ${this.editUser} 님께서 수정 중입니다. 체크인 하는 경우 ${this.editUser} 님이 수정한 내용은 손상되어 저장되지 않습니다. 체크인 하시겠습니까?`,this.enableEdit=!1),this.alertType="checkin",this.$nextTick(()=>{const t=document.getElementById("confirmButton"),u=document.getElementById("cancelButton");t.onclick=()=>e(!0),u.onclick=()=>e(!1)})):(this.lock=!1,this.enableEdit=!1,this.alertDialog=!0,this.alertMessage="프로세스 정의 체계도를 수정하시겠습니까?",this.alertType="checkout",this.$nextTick(()=>{const t=document.getElementById("confirmButton"),u=document.getElementById("cancelButton");t.onclick=()=>e(!0),u.onclick=()=>e(!1)}))}})},closeAlertDialog(){this.alertDialog=!1,this.alertType="",this.alertMessage=""}}},rs={key:0,class:"pa-3 d-flex align-center",style:{position:"sticky",top:"0","z-index":"2","background-color":"white"}},cs={class:"text-h5 font-weight-semibold"},ds={class:"ml-auto d-flex"},us={key:3,class:"ml-1"},fs={id:"processMap"},ps={key:0},ms={key:1},hs={key:2},gs=I("확인"),bs=I("확인"),vs=I("체크인"),ys=I("닫기"),_s=I("취소");function Ps(e,s,t,u,g,n){const p=S("Icon"),l=S("LockIcon"),j=S("LockOpenIcon"),C=S("ViewProcessDetails"),V=S("SubProcessDetail"),M=S("DefinitionMapList");return a(),m("div",null,[i(N,{elevation:"10",style:Ee([e.$globalState.state.isZoomed?"height:100vh;":"height:calc(100vh - 155px)",{overflow:"auto"}])},{default:o(()=>[t.componentName!="SubProcessDetail"?(a(),m("div",rs,[d("h5",cs,B(e.$t("processDefinitionMap.title")),1),e.$route.path!=="/definition-map"?(a(),f(A,{key:0,style:{"margin-left":"3px","margin-top":"1px"},icon:"",variant:"text",size:"24"},{default:o(()=>[i(p,{onClick:n.goProcessMap,icon:"humbleicons:arrow-go-back",width:"24",height:"24"},null,8,["onClick"])]),_:1})):_("",!0),d("div",ds,[!e.lock&&e.isAdmin?(a(),f(X,{key:0,location:"bottom"},{activator:o(({props:z})=>[i(A,x(z,{icon:"",variant:"text",size:"24",class:"ml-3 cp-unlock",onClick:n.openAlertDialog}),{default:o(()=>[i(l,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:o(()=>[d("span",null,B(e.$t("processDefinitionMap.unlock")),1)]),_:1})):_("",!0),e.lock&&e.isAdmin&&e.userName==e.editUser?(a(),f(X,{key:1,location:"bottom"},{activator:o(({props:z})=>[i(A,x(z,{icon:"",variant:"text",size:"24",class:"cp-lock",onClick:n.openAlertDialog}),{default:o(()=>[i(j,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:o(()=>[d("span",null,B(e.$t("processDefinitionMap.lock")),1)]),_:1})):_("",!0),e.lock&&e.isAdmin&&e.userName!=e.editUser?(a(),f(X,{key:2,location:"bottom"},{activator:o(({props:z})=>[i(A,x(z,{icon:"",variant:"text",size:"24",class:"cp-lock",onClick:n.openAlertDialog}),{default:o(()=>[i(l,{width:"24",height:"24"})]),_:2},1040,["onClick"])]),default:o(()=>[d("span",null,B(e.$t("processDefinitionMap.lock")),1)]),_:1})):_("",!0),e.lock&&e.userName&&e.userName!=e.editUser?(a(),m("span",us,B(e.editUser)+" 님이 수정 중 입니다. ",1)):_("",!0),i(A,{icon:"",variant:"text",size:24,class:"ml-3",onClick:n.capturePng},{default:o(()=>[i(p,{icon:"mage:image-download",width:"24",height:"24"})]),_:1},8,["onClick"]),t.componentName!="SubProcessDetail"?(a(),f(X,{key:4,text:e.$t("processDefinition.zoom")},{activator:o(({props:z})=>[i(A,x(z,{class:"ml-3 processVariables-zoom",onClick:s[0]||(s[0]=ye=>e.$globalState.methods.toggleZoom()),icon:"",variant:"text",size:24}),{default:o(()=>[e.$globalState.state.isZoomed?(a(),f(p,{key:1,icon:"material-symbols:zoom-in-map-rounded",width:"24",height:"24"})):(a(),f(p,{key:0,icon:"material-symbols:zoom-out-map-rounded",width:"24",height:"24"}))]),_:2},1040)]),_:1},8,["text"])):_("",!0)])])):_("",!0),d("div",fs,[t.componentName=="ViewProcessDetails"?(a(),m("div",ps,[i(C,{class:"pa-5",value:e.value,enableEdit:e.enableEdit},null,8,["value","enableEdit"])])):t.componentName=="SubProcessDetail"?(a(),m("div",ms,[i(V,{value:e.value,onCapture:n.capturePng,enableEdit:e.enableEdit},null,8,["value","onCapture","enableEdit"])])):(a(),m("div",hs,[i(M,{value:e.value,enableEdit:e.enableEdit},null,8,["value","enableEdit"])]))])]),_:1},8,["style"]),i(be,{modelValue:e.alertDialog,"onUpdate:modelValue":s[3]||(s[3]=z=>e.alertDialog=z),"max-width":"500",persistent:""},{default:o(()=>[i(N,null,{default:o(()=>[i(ge,{class:"mt-2"},{default:o(()=>[I(B(e.alertMessage),1)]),_:1}),i(we,{class:"justify-center"},{default:o(()=>[e.alertType=="checkout"?(a(),f(A,{key:0,color:"primary",class:"cp-check-out",variant:"flat",onClick:n.checkOut},{default:o(()=>[gs]),_:1},8,["onClick"])):e.alertType=="checkin"&&e.userName&&e.userName==e.editUser?(a(),f(A,{key:1,color:"primary",class:"cp-check-in",variant:"flat",onClick:n.checkIn},{default:o(()=>[bs]),_:1},8,["onClick"])):e.alertType=="checkin"&&e.userName&&e.userName!=e.editUser?(a(),f(A,{key:2,color:"primary",class:"cp-check-in",variant:"flat",onClick:n.checkOut},{default:o(()=>[vs]),_:1},8,["onClick"])):_("",!0),e.userName&&e.userName==e.editUser?(a(),f(A,{key:3,color:"error",variant:"flat",onClick:s[1]||(s[1]=z=>e.alertDialog=!1)},{default:o(()=>[ys]),_:1})):(a(),f(A,{key:4,color:"error",variant:"flat",onClick:s[2]||(s[2]=z=>e.alertDialog=!1)},{default:o(()=>[_s]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Ss=Q(ls,[["render",Ps]]);export{Ss as default};
