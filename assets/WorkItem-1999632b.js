import{I as N,_ as A,s as C,o as s,c as m,b as o,w as a,a8 as x,V as g,F as d,aj as D,a as c,L as F,d as u,S as $,J as P,x as i,z as I,B as K,am as B,ae as M,G as y,an as _,ao as z,ap as v,M as E,aH as j,al as T}from"./index-dcd728bc.js";import{P as O}from"./ProcessDefinition-e2ef86e1.js";import{D as Z,W as R,P as G}from"./ProcessInstanceChat-94f3c01f.js";import{_ as J}from"./DynamicForm-d987c0fb.js";import{V as L}from"./VAlert-d5b63406.js";import{V as U,a as b}from"./VWindowItem-1543f0aa.js";import"./hooks.module-fbc9fa96.js";import"./ProcessExecuteDialog-0c343f72.js";import"./VDataTable-2936e7e3.js";import"./VSheet-42154d36.js";import"./index-9159cc7e.js";import"./Chat-1fd8903b.js";import"./chat-icon-7da84487.js";const q=N.createBackend(),Q={props:{workItem:{type:Object,default:function(){return null}},workItemStatus:{type:String,default:function(){return null}},isComplete:Boolean},data:()=>({inputItems:null}),components:{DefaultForm:Z},created(){this.init()},methods:{async init(){var e=this;e.workItem.activity.parameters||(e.workItem.activity.parameters=[]),e.inputItems=e.workItem.activity.parameters.filter(t=>t.direction.includes("OUT")).map(t=>({name:t.variable.name,value:null}))},async completeTask(){var e=this;e.$try({context:e,action:async()=>{let t={parameterValues:{}},l=this.inputItems.reduce((k,h)=>({...k,[h.name]:h.value}),{});l&&(t.parameterValues=l),e.workItem.execScope&&(t.execScope=e.workItem.execScope),await q.putWorkItemComplete(e.$route.params.taskId,t),e.$router.push("/todolist")},successMsg:"해당 업무 완료"})}}},X={key:0},Y=u("완료"),ee={style:{height:"calc(100vh - 255px)",padding:"20px"}};function te(e,t,l,k,h,r){const f=C("DefaultForm");return s(),m(F,null,[o(D,{class:"ma-0 pa-0 task-btn",style:{right:"40px"}},{default:a(()=>[o(x),l.isComplete?d("",!0):(s(),m("div",X,[o(g,{onClick:t[0]||(t[0]=V=>r.completeTask()),color:"#0085DB",style:{color:"white"},rounded:""},{default:a(()=>[Y]),_:1})]))]),_:1}),c("div",ee,[o(f,{inputItems:e.inputItems},null,8,["inputItems"])])],64)}const ae=A(Q,[["render",te]]);const w=N.createBackend(),oe={props:{workItem:{type:Object,default:function(){return null}},workItemStatus:{type:String,default:function(){return null}}},data:()=>({html:null,formData:{}}),components:{DynamicForm:J},mounted(){this.init()},methods:{async init(){var e=this;let t=e.workItem.worklist.tool.split(":")[1];e.html=await w.getRawDefinition(t,{type:"form"}),this.loadForm()},async loadForm(){var e=this;if(!e.workItem.activity||!e.workItem.activity.variableForHtmlFormContext)return;let t=e.workItem.activity.variableForHtmlFormContext.name,l=await w.getVariableWithTaskId(e.workItem.worklist.instId,e.$route.params.taskId,t);l&&l.valueMap?e.formData=l.valueMap:e.formData={}},async saveTask(){var e=this;e.$try({context:e,action:async()=>{let t=e.workItem.activity.variableForHtmlFormContext.name,l=await w.getVariableWithTaskId(e.workItem.worklist.instId,e.$route.params.taskId,t);l||(l={}),l._type="org.uengine.contexts.HtmlFormContext",l.valueMap=this.formData,Object.keys(l.valueMap).forEach(k=>{typeof l.valueMap[k]=="object"&&l.valueMap[k].forEach(h=>{h._type="java.util.HashMap"})}),l.valueMap._type="java.util.HashMap",await w.setVariableWithTaskId(e.workItem.worklist.instId,e.$route.params.taskId,t,l),await w.putWorkItem(e.$route.params.taskId,{parameterValues:{}})},successMsg:"중간 저장 완료"})},async saveForm(){let e=this,t=e.workItem.activity.variableForHtmlFormContext.name,l=await w.getVariableWithTaskId(e.workItem.worklist.instId,e.$route.params.taskId,t);l||(l={}),l._type="org.uengine.contexts.HtmlFormContext",l.valueMap=this.formData,Object.keys(l.valueMap).forEach(k=>{typeof l.valueMap[k]=="object"&&l.valueMap[k].forEach(h=>{h._type="java.util.HashMap"})}),l.valueMap._type="java.util.HashMap",await w.setVariableWithTaskId(e.workItem.worklist.instId,e.$route.params.taskId,t,l)},async completeTask(){let e=this,t={parameterValues:{}};$mode=="uEngine"&&await e.saveForm(),$mode=="ProcessGPT"&&(t.parameterValues=e.formData),e.workItem.execScope&&(t.execScope=e.workItem.execScope);const l=e.$refs.dynamicForm.validate();if(l&&l.length>0){alert(`※ 폼에 정의된 유효성 검사에 실패했습니다 !
> `+l);return}await w.putWorkItemComplete(e.$route.params.taskId,t),e.$router.push("/todolist")}}},se={key:0,class:"from-work-item-pc"},le=u("중간 저장"),re=u("제출 완료"),ie={key:1,class:"from-work-item-mobile"},ne={class:"pa-4"};function me(e,t,l,k,h,r){const f=C("Icon"),V=C("DynamicForm");return s(),m(F,null,[o(D,{class:"ma-0 pa-0 task-btn",style:{right:"40px"}},{default:a(()=>[o(x),l.workItemStatus=="NEW"||l.workItemStatus=="DRAFT"?(s(),m("div",se,[o(g,{onClick:t[0]||(t[0]=p=>r.saveTask()),color:"#0085DB",style:{color:"white"},rounded:""},{default:a(()=>[le]),_:1}),o(g,{onClick:t[1]||(t[1]=p=>e.$try(r.completeTask,null,{sucessMsg:"워크아이템 완료"})),variant:"tex",rounded:""},{default:a(()=>[re]),_:1})])):d("",!0),l.workItemStatus=="NEW"||l.workItemStatus=="DRAFT"?(s(),m("div",ie,[o($,{text:"중간 저장"},{activator:a(({props:p})=>[o(g,P({onClick:t[2]||(t[2]=n=>r.saveTask()),icon:""},p,{density:"comfortable"}),{default:a(()=>[o(f,{icon:"mdi:content-save-plus-outline",width:"32",height:"32"})]),_:2},1040)]),_:1}),o($,{text:"제출 완료"},{activator:a(({props:p})=>[o(g,P({onClick:t[3]||(t[3]=n=>e.$try(r.completeTask,null,{sucessMsg:"워크아이템 완료"})),variant:"tex",icon:""},p,{density:"comfortable"}),{default:a(()=>[o(f,{icon:"iconoir:submit-document",width:"28",height:"28"})]),_:2},1040)]),_:1})])):d("",!0)]),_:1}),c("div",ne,[o(V,{ref:"dynamicForm",formHTML:e.html,modelValue:e.formData,"onUpdate:modelValue":t[4]||(t[4]=p=>e.formData=p)},null,8,["formHTML","modelValue"])])],64)}const de=A(oe,[["render",me]]);const H=N.createBackend(),ue={components:{ProcessDefinition:O,DefaultWorkItem:ae,FormWorkItem:de,"work-history-uEngine":R,"work-history-ProcessGPT":G},data:()=>({bpmn:null,workItem:null,checkPoints:null,workListByInstId:null,currentComponent:null,currentActivities:[],updatedKey:0,updatedDefKey:0,loading:!1,selectedTab:"progress",eventList:[]}),created(){this.init(),this.EventBus.on("process-definition-updated",async()=>{this.updatedDefKey++})},computed:{mode(){return window.$mode},checkedCount(){return this.checkPoints?this.checkPoints.filter(e=>e.checked).length:0},messages(){return this.workListByInstId?this.workListByInstId.map(e=>({profile:"https://avatars0.githubusercontent.com/u/9064066?v=4&s=460",roleName:e.task.roleName,_item:e,content:e.title,description:e.description,timeStamp:e.startDate})):[]},id(){return this.$route.params.taskId?this.$route.params.taskId:null},workItemStatus(){return this.workItem?this.workItem.worklist.status:null},isComplete(){return this.workItemStatus=="COMPLETED"||this.workItemStatus=="DONE"}},methods:{init(){var e=this;e.$try({context:e,action:async()=>{e.workItem=await H.getWorkItem(e.id),e.bpmn=await H.getRawDefinition(e.workItem.worklist.defId,{type:"bpmn"}),e.workItem.worklist.execScope&&(e.workItem.execScope=e.workItem.worklist.execScope),e.workListByInstId=await H.getWorkListByInstId(e.workItem.worklist.instId),e.currentComponent=e.workItem.worklist.tool.includes("formHandler")?"FormWorkItem":"DefaultWorkItem",e.currentActivities=[e.workItem.activity.tracingTag],e.updatedDefKey++}})},navigateToWorkItemByTaskId(e){var t=this;t.$router.push(`/todolist/${e._item.taskId}`),this.$nextTick(()=>{t.delay(500).then(()=>{t.init(),t.updatedKey++})})},delay(e){return new Promise(t=>setTimeout(t,e))}}},ce={style:{"font-size":"20px","font-weight":"500"}},pe={key:0,class:"work-itme-current-component"},ke=u("진행 상황/체크포인트"),he=u("진행 상황"),fe=u("워크 히스토리"),ye=u("Agent 초안 생성"),ve={key:0,style:{height:"100%"}},we={key:1},ge={key:0,style:{overflow:"auto",height:"50%"}},Ie={style:{margin:"-15px 0px 0px 5px"}},_e={key:0,class:"work-itme-current-component"},be=u("진행 상황/체크포인트"),Ce=u("진행 상황"),Ve=u("워크 히스토리"),Se=u("Agent 초안 생성"),Te={key:0,style:{height:"100%"}},De={key:1},Me={key:0,style:{overflow:"auto",height:"50%"}},Fe={style:{margin:"-15px 0px 0px 5px"}};function $e(e,t,l,k,h,r){const f=C("Icon"),V=C("process-definition"),p=C("perfect-scrollbar");return e.workItem?(s(),i(T,{elevation:"10",key:e.updatedKey},{default:a(()=>[o(B,null,{default:a(()=>[o(D,{class:"ma-0 pa-0 mt-1 ml-3",style:{"line-height":"100%"}},{default:a(()=>[c("div",ce,I(e.workItem.activity.name),1),o(K,{size:"small",variant:"outlined",density:"comfortable",style:{"margin-left":"5px"}},{default:a(()=>[u(I(r.workItemStatus),1)]),_:1})]),_:1})]),_:1}),o(D,{class:"ma-0 pa-2 mt-2 work-item-pc"},{default:a(()=>[o(M,{class:"pa-0",cols:"4",style:y([e.$globalState.state.isZoomed?"height: calc(100vh - 70px);":"height: calc(100vh - 215px);",{overflow:"auto"}])},{default:a(()=>[e.currentComponent?(s(),m("div",pe,[(s(),i(_(e.currentComponent),{"work-item":e.workItem,workItemStatus:r.workItemStatus,isComplete:r.isComplete},null,8,["work-item","workItemStatus","isComplete"])),o($,{text:e.$t("processDefinition.zoom")},{activator:a(({props:n})=>[o(g,P({onClick:t[0]||(t[0]=S=>e.$globalState.methods.toggleZoom()),size:"small",icon:""},n,{class:"processVariables-zoom task-btn"}),{default:a(()=>[e.$globalState.state.isZoomed?(s(),i(f,{key:1,icon:"material-symbols:zoom-in-map-rounded",width:"32",height:"32"})):(s(),i(f,{key:0,icon:"material-symbols:zoom-out-map-rounded",width:"32",height:"32"}))]),_:2},1040)]),_:1},8,["text"])])):d("",!0)]),_:1},8,["style"]),o(M,{class:"pa-0",cols:"8"},{default:a(()=>[o(L,{class:"pa-0 mt-4",color:"#2196F3",variant:"outlined"},{default:a(()=>[o(z,{modelValue:e.selectedTab,"onUpdate:modelValue":t[1]||(t[1]=n=>e.selectedTab=n)},{default:a(()=>[e.checkPoints?(s(),i(v,{key:0,value:"progress"},{default:a(()=>[ke]),_:1})):(s(),i(v,{key:1,value:"progress"},{default:a(()=>[he]),_:1})),r.messages&&r.messages.length>0?(s(),i(v,{key:2,value:"history"},{default:a(()=>[fe]),_:1})):d("",!0),r.messages?(s(),i(v,{key:3,value:"agent"},{default:a(()=>[ye]),_:1})):d("",!0)]),_:1},8,["modelValue"]),o(U,{modelValue:e.selectedTab,"onUpdate:modelValue":t[2]||(t[2]=n=>e.selectedTab=n)},{default:a(()=>[o(b,{value:"progress"},{default:a(()=>[c("div",{class:"pa-2",style:y([e.$globalState.state.isZoomed?"height: calc(100vh - 130px);":"height: calc(100vh - 280px);",{color:"black",overflow:"auto"}])},[c("div",{class:"pa-0 pl-2",style:y(e.checkPoints?"height:50%;":"height:100%;")},[e.bpmn?(s(),m("div",ve,[(s(),i(V,{style:{height:"100%"},currentActivities:e.currentActivities,bpmn:e.bpmn,key:e.updatedDefKey,isViewMode:!0},null,8,["currentActivities","bpmn"]))])):(s(),m("div",we,"No BPMN found"))],4),e.checkPoints?(s(),m("div",ge,[o(B,null,{default:a(()=>[u("CheckPoint ("+I(r.checkedCount)+"/"+I(e.checkPoints?e.checkPoints.length:0)+")",1)]),_:1}),c("div",Ie,[(s(!0),m(F,null,E(e.checkPoints,(n,S)=>(s(),m("div",{key:S,style:{height:"40px"}},[o(j,{style:{height:"40px !important"},modelValue:n.checked,"onUpdate:modelValue":W=>n.checked=W,label:n.name,color:"primary","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]))),128))])])):d("",!0)],4)]),_:1}),o(b,{value:"history",class:"pa-2"},{default:a(()=>[o(T,{elevation:"10",class:"pa-4"},{default:a(()=>[r.messages.length>0?(s(),i(p,{key:0,class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:a(()=>[c("div",{class:"d-flex w-100",style:y([{overflow:"auto"},e.workHistoryHeight])},[(s(),i(_("work-history-"+r.mode),{messages:r.messages,isComplete:r.isComplete,onClickMessage:r.navigateToWorkItemByTaskId},null,8,["messages","isComplete","onClickMessage"]))],4)]),_:1},8,["onScroll"])):d("",!0)]),_:1})]),_:1}),o(b,{value:"agent",class:"pa-2"},{default:a(()=>[o(T,{elevation:"10",class:"pa-4"},{default:a(()=>[r.messages.length>0?(s(),i(p,{key:0,class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:a(()=>[c("div",{class:"d-flex w-100",style:y([{overflow:"auto"},e.workHistoryHeight])},[(s(),i(_("work-history-"+r.mode),{messages:[],isAgentMode:!0}))],4)]),_:1},8,["onScroll"])):d("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(D,{class:"ma-0 pa-2 mt-2 work-item-mobile"},{default:a(()=>[o(M,{class:"pa-0",cols:"12",style:{overflow:"auto"}},{default:a(()=>[e.currentComponent?(s(),m("div",_e,[(s(),i(_(e.currentComponent),{"work-item":e.workItem,workItemStatus:r.workItemStatus,isComplete:r.isComplete},null,8,["work-item","workItemStatus","isComplete"])),o($,{text:e.$t("processDefinition.zoom")},{activator:a(({props:n})=>[o(g,P({onClick:t[3]||(t[3]=S=>e.$globalState.methods.toggleZoom()),size:"small",icon:""},n,{class:"processVariables-zoom task-btn"}),{default:a(()=>[e.$globalState.state.isZoomed?(s(),i(f,{key:1,icon:"material-symbols:zoom-in-map-rounded",width:"32",height:"32"})):(s(),i(f,{key:0,icon:"material-symbols:zoom-out-map-rounded",width:"32",height:"32"}))]),_:2},1040)]),_:1},8,["text"])])):d("",!0)]),_:1}),o(M,{class:"pa-0",cols:"12"},{default:a(()=>[o(L,{class:"pa-0 mt-4",color:"#2196F3",variant:"outlined"},{default:a(()=>[o(z,{modelValue:e.selectedTab,"onUpdate:modelValue":t[4]||(t[4]=n=>e.selectedTab=n)},{default:a(()=>[e.checkPoints?(s(),i(v,{key:0,value:"progress"},{default:a(()=>[be]),_:1})):(s(),i(v,{key:1,value:"progress"},{default:a(()=>[Ce]),_:1})),r.messages&&r.messages.length>0?(s(),i(v,{key:2,value:"history"},{default:a(()=>[Ve]),_:1})):d("",!0),r.messages?(s(),i(v,{key:3,value:"agent"},{default:a(()=>[Se]),_:1})):d("",!0)]),_:1},8,["modelValue"]),o(U,{modelValue:e.selectedTab,"onUpdate:modelValue":t[5]||(t[5]=n=>e.selectedTab=n)},{default:a(()=>[o(b,{value:"progress"},{default:a(()=>[c("div",{class:"pa-2",style:y([e.$globalState.state.isZoomed?"height: calc(100vh - 130px);":"height: calc(100vh - 280px);",{color:"black",overflow:"auto"}])},[c("div",{class:"pa-0 pl-2",style:y(e.checkPoints?"height:50%;":"height:100%;")},[e.bpmn?(s(),m("div",Te,[(s(),i(V,{style:{height:"100%"},currentActivities:e.currentActivities,bpmn:e.bpmn,key:e.updatedDefKey,isViewMode:!0},null,8,["currentActivities","bpmn"]))])):(s(),m("div",De,"No BPMN found"))],4),e.checkPoints?(s(),m("div",Me,[o(B,null,{default:a(()=>[u("CheckPoint ("+I(r.checkedCount)+"/"+I(e.checkPoints?e.checkPoints.length:0)+")",1)]),_:1}),c("div",Fe,[(s(!0),m(F,null,E(e.checkPoints,(n,S)=>(s(),m("div",{key:S,style:{height:"40px"}},[o(j,{style:{height:"40px !important"},modelValue:n.checked,"onUpdate:modelValue":W=>n.checked=W,label:n.name,color:"primary","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]))),128))])])):d("",!0)],4)]),_:1}),o(b,{value:"history",class:"pa-2"},{default:a(()=>[o(T,{elevation:"10",class:"pa-4"},{default:a(()=>[r.messages.length>0?(s(),i(p,{key:0,class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:a(()=>[c("div",{class:"d-flex w-100",style:y([{overflow:"auto"},e.workHistoryHeight])},[(s(),i(_("work-history-"+r.mode),{messages:r.messages,isComplete:r.isComplete,onClickMessage:r.navigateToWorkItemByTaskId},null,8,["messages","isComplete","onClickMessage"]))],4)]),_:1},8,["onScroll"])):d("",!0)]),_:1})]),_:1}),o(b,{value:"agent",class:"pa-2"},{default:a(()=>[o(T,{elevation:"10",class:"pa-4"},{default:a(()=>[r.messages.length>0?(s(),i(p,{key:0,class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:a(()=>[c("div",{class:"d-flex w-100",style:y([{overflow:"auto"},e.workHistoryHeight])},[(s(),i(_("work-history-"+r.mode),{messages:[],isAgentMode:!0}))],4)]),_:1},8,["onScroll"])):d("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})):d("",!0)}const Oe=A(ue,[["render",$e]]);export{Oe as default};
