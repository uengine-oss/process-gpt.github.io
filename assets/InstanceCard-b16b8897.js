import{I,_ as v,s as p,o,x as i,w as s,b as n,am as C,a as _,c as g,al as m,an as P,F as L,d as c,M as B,ae as V,L as E,aj as N,z as k,B as M,V as O,ao as S,ap as T,$ as A,aq as W}from"./index-dcd728bc.js";import{_ as R}from"./AppBaseCard.vue_vue_type_style_index_0_lang-86309e8f.js";import{P as x}from"./ProcessDefinition-e2ef86e1.js";import{W as G,P as K}from"./ProcessInstanceChat-94f3c01f.js";import{T as F,a as z}from"./TodoTaskColumn-e3bbfdfb.js";import{V as U,a as D}from"./VWindowItem-1543f0aa.js";import"./hooks.module-fbc9fa96.js";import"./ProcessExecuteDialog-0c343f72.js";import"./VDataTable-2936e7e3.js";import"./DynamicForm-d987c0fb.js";import"./Chat-1fd8903b.js";import"./chat-icon-7da84487.js";import"./VSheet-42154d36.js";import"./VAlert-d5b63406.js";import"./index-9159cc7e.js";import"./index-18289fd3.js";const h=I.createBackend(),j={components:{ProcessDefinition:x,"work-history-uEngine":G,"work-history-ProcessGPT":K,AppBaseCard:R},data:()=>({bpmn:null,instance:null,workListByInstId:null,currentActivities:[],updatedKey:0,updatedDefKey:0,eventList:[]}),created(){this.init(),this.EventBus.on("process-definition-updated",async()=>{this.bpmn=await h.getRawDefinition(this.instance.defId,{type:"bpmn"}),this.updatedDefKey++})},computed:{mode(){return window.$mode},id(){return atob(this.$route.params.instId)},messages(){return this.workListByInstId?this.workListByInstId.map(t=>({profile:"https://avatars0.githubusercontent.com/u/9064066?v=4&s=460",roleName:t.task.roleName,_item:t,content:t.title,description:t.description,timeStamp:t.startDate})):[]},isComplete(){return this.instance.status=="COMPLETED"}},methods:{init(){var t=this;t.$try({context:t,action:async()=>{t.id&&(t.instance=await h.getInstance(t.id),t.bpmn=await h.getRawDefinition(t.instance.defId,{type:"bpmn"}),t.workListByInstId=await h.getWorkListByInstId(t.instance.instanceId),t.currentActivities=t.workListByInstId.map(e=>e.tracingTag),t.eventList=await h.getEventList(t.instance.instanceId),t.updatedDefKey++)}})},delay(t){return new Promise(e=>setTimeout(e,t))},fireMessage(t){h.fireMessage(this.instance.instanceId,t)}}},q=c("프로세스 진행상태"),H={style:{overflow:"auto"}},J={key:0,style:{height:"100%"}},Q=c(" No BPMN found "),X={class:"d-flex w-100"},Y=c("프로세스 진행상태"),Z={style:{overflow:"auto",height:"calc(100vh - 620px)"}},tt={key:0,style:{height:"100%"}},et=c(" No BPMN found ");function st(t,e,a,r,b,d){const f=p("process-definition"),u=p("dif"),l=p("perfect-scrollbar"),w=p("AppBaseCard");return o(),i(w,null,{leftpart:s(()=>[n(m,{flat:""},{default:s(()=>[n(C,null,{default:s(()=>[q]),_:1}),_("div",H,[t.bpmn?(o(),g("div",J,[(o(),i(f,{class:"work-item-definition",currentActivities:t.currentActivities,bpmn:t.bpmn,key:t.updatedDefKey,isViewMode:!0},null,8,["currentActivities","bpmn"]))])):(o(),i(u,{key:1},{default:s(()=>[Q]),_:1}))])]),_:1})]),rightpart:s(()=>[n(m,{flat:""},{default:s(()=>[d.messages.length>0?(o(),i(l,{key:0,class:"h-100",ref:"scrollContainer",onScroll:t.handleScroll},{default:s(()=>[_("div",X,[(o(),i(P("work-history-"+d.mode),{messages:d.messages,isComplete:d.isComplete,onClickMessage:t.navigateToWorkItemByTaskId},null,8,["messages","isComplete","onClickMessage"]))])]),_:1},8,["onScroll"])):L("",!0)]),_:1})]),mobileLeftContent:s(()=>[n(m,{flat:""},{default:s(()=>[n(C,null,{default:s(()=>[Y]),_:1}),_("div",Z,[t.bpmn?(o(),g("div",tt,[(o(),i(f,{class:"work-item-definition",currentActivities:t.currentActivities,bpmn:t.bpmn,key:t.updatedDefKey,isViewMode:!0},null,8,["currentActivities","bpmn"]))])):(o(),i(u,{key:1},{default:s(()=>[et]),_:1}))])]),_:1})]),_:1})}const at=v(j,[["render",st]]),$=I.createBackend(),nt={components:{TodoTaskColumn:F,TodoDialog:z},data:()=>({todolist:[{id:"TODO",title:"todoList.todo",cardbg:"background",tasks:[]},{id:"IN_PROGRESS",title:"todoList.inProgress",cardbg:"lightsecondary",tasks:[]},{id:"PENDING",title:"todoList.pending",cardbg:"lightinfo",tasks:[]},{id:"DONE",title:"todoList.done",cardbg:"lightsuccess",tasks:[]}],loading:!1,offset:10,currentPage:0}),created(){this.loadToDo(),this.loadCompletedWorkList()},computed:{id(){return atob(this.$route.params.instId)}},watch:{$route:{deep:!0,handler(t,e){t.params.instId&&t.params.instId!==e.params.instId&&(this.todolist.forEach(a=>{a.tasks=[]}),this.loadToDo(),this.loadCompletedWorkList())}}},methods:{executeTask(t){var e=this;e.$router.push(`/todolist/${t.taskId}`)},loadToDo(){var t=this;t.$try({context:t,action:async()=>{let e=await $.getWorkList();e||(e=[]),e.forEach(a=>{a.instId==t.id&&(a.status=="TODO"||a.status=="NEW"||a.status=="DRAFT"?t.todolist.find(r=>r.id=="TODO").tasks.push(a):a.status=="IN_PROGRESS"?t.todolist.find(r=>r.id=="IN_PROGRESS").tasks.push(a):a.status=="PENDING"&&t.todolist.find(r=>r.id=="PENDING").tasks.push(a))})}})},loadCompletedWorkList(){var t=this;t.$try({context:t,action:async()=>{let e=await $.getCompletedList({page:t.currentPage,size:t.offset});e||(e=[]),e.forEach(function(a){a.instId==t.id&&(a.status=="DONE"||a.status=="COMPLETED")&&t.todolist.find(r=>r.id=="DONE").tasks.push(a)})}})},handleScrollBottom(){var t=this;t.$try({context:t,action:async()=>{t.loading=!0,t.currentPage++,await t.loadCompletedWorkList(),t.loading=!1}})}}},ot={class:"pa-5 h-100"};function it(t,e,a,r,b,d){const f=p("TodoTaskColumn");return o(),i(m,{elevation:"10"},{default:s(()=>[_("div",ot,[n(N,{class:"ma-0 pa-0"},{default:s(()=>[(o(!0),g(E,null,B(t.todolist,u=>(o(),i(V,{key:u.id,cols:"12",md:"3",sm:"6"},{default:s(()=>[n(f,{column:u,loading:t.loading,onExecuteTask:d.executeTask,onScrollBottom:d.handleScrollBottom},null,8,["column","loading","onExecuteTask","onScrollBottom"])]),_:2},1024))),128))]),_:1})])]),_:1})}const rt=v(nt,[["render",it]]);const y=I.createBackend(),dt={components:{InstanceProgress:at,InstanceTodo:rt},data:()=>({instance:null,eventList:[],tab:"progress"}),watch:{$route:{deep:!0,async handler(t,e){t.params.instId&&t.params.instId!==e.params.instId&&await this.init()}}},created(){this.init(),this.EventBus.on("process-definition-updated",async()=>{this.bpmn=await y.getRawDefinition(this.instance.defId,{type:"bpmn"}),this.updatedDefKey++})},computed:{id(){return atob(this.$route.params.instId)},isComplete(){return this.instance.status=="COMPLETED"}},methods:{init(){var t=this;t.$try({context:t,action:async()=>{t.id&&(t.instance=await y.getInstance(t.id),t.eventList=await y.getEventList(t.instance.instanceId))}})},delay(t){return new Promise(e=>setTimeout(e,t))},fireMessage(t){y.fireMessage(this.instance.instanceId,t)}}},lt={class:"px-3 pt-3 pb-2 d-flex align-center"},ct={class:"text-h5 font-weight-semibold"},ut=c(" 진행 상황 "),pt=c(" 워크아이템 ");function mt(t,e,a,r,b,d){const f=p("InstanceProgress"),u=p("InstanceTodo");return t.instance?(o(),i(m,{key:0,elevation:"10",style:{height:"calc(100vh - 155px)"}},{default:s(()=>[_("div",lt,[_("h5",ct,k(t.instance.name)+" (ID: "+k(t.instance.instanceId)+") ",1),t.instance.status?(o(),i(M,{key:0,size:"x-small",variant:"outlined",style:{margin:"2px 0px 0px 5px !important",display:"flex","align-items":"center"}},{default:s(()=>[c(k(t.instance.status),1)]),_:1})):L("",!0),(o(!0),g(E,null,B(t.eventList,l=>(o(),g("div",null,[n(O,{onClick:w=>d.fireMessage(l)},{default:s(()=>[c(k(l)+" 보내기 ",1)]),_:2},1032,["onClick"])]))),256))]),n(m,{flat:""},{default:s(()=>[n(S,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=l=>t.tab=l),"bg-color":"transparent",height:"50",color:"primary"},{default:s(()=>[n(T,{value:"progress"},{default:s(()=>[ut]),_:1}),n(T,{value:"todo"},{default:s(()=>[pt]),_:1})]),_:1},8,["modelValue"]),n(A),n(W,{class:"pa-0"},{default:s(()=>[n(U,{modelValue:t.tab,"onUpdate:modelValue":e[1]||(e[1]=l=>t.tab=l)},{default:s(()=>[n(D,{value:"progress"},{default:s(()=>[n(f)]),_:1}),n(D,{value:"todo"},{default:s(()=>[n(u)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})):(o(),i(m,{key:1}))}const Et=v(dt,[["render",mt]]);export{Et as default};
