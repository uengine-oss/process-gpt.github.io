import{p as Ve,be as Te,bf as Ue,bg as ze,h as De,b8 as Be,bh as Ne,bi as Fe,r as z,bj as he,a3 as ie,a5 as Oe,q as je,bk as qe,bl as me,bm as We,b as n,bn as He,J as P,L as x,B as le,bo as Ee,bp as Ge,bq as Je,br as Ze,_ as j,K as te,s as M,o as i,x as m,w as l,c,V as _,aE as ee,F as h,aq as oe,a as r,av as Z,ay as Y,M as I,d as w,z as f,al as J,R as B,aj as S,A as V,G as R,aC as ge,aD as fe,aI as ne,$ as D,ae,a8 as X,T as $e,H as Ke,bs as Qe,Q as ye,am as pe,S as G,aF as Xe,a7 as Ye,bt as et,aG as tt}from"./index-dcd728bc.js";import{P as _e,_ as q}from"./chat-icon-7da84487.js";import{V as O}from"./VSheet-42154d36.js";import{V as st}from"./VAlert-d5b63406.js";const it=Ve({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},multiple:Boolean,showSize:{type:[Boolean,Number],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(e)},...Te({prependIcon:"$file"}),modelValue:{type:Array,default:()=>[],validator:e=>Ue(e).every(t=>t!=null&&typeof t=="object")},...ze({clearable:!0})},"VFileInput"),nt=De()({name:"VFileInput",inheritAttrs:!1,props:it(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:s,emit:y,slots:d}=t;const{t:a}=Be(),p=Ne(e,"modelValue"),{isFocused:u,focus:k,blur:N}=Fe(e),T=z(()=>typeof e.showSize!="boolean"?e.showSize:void 0),F=z(()=>(p.value??[]).reduce((v,C)=>{let{size:W=0}=C;return v+W},0)),K=z(()=>he(F.value,T.value)),o=z(()=>(p.value??[]).map(v=>{const{name:C="",size:W=0}=v;return e.showSize?`${C} (${he(W,T.value)})`:C})),b=z(()=>{var C;const v=((C=p.value)==null?void 0:C.length)??0;return e.showSize?a(e.counterSizeString,v,K.value):a(e.counterString,v)}),g=ie(),L=ie(),A=ie(),ve=z(()=>u.value||e.active),re=z(()=>["plain","underlined"].includes(e.variant));function se(){var v;A.value!==document.activeElement&&((v=A.value)==null||v.focus()),u.value||k()}function be(v){de(v)}function ke(v){y("mousedown:control",v)}function de(v){var C;(C=A.value)==null||C.click(),y("click:control",v)}function xe(v){v.stopPropagation(),se(),Je(()=>{p.value=[],Ze(e["onClick:clear"],v)})}return Oe(p,v=>{(!Array.isArray(v)||!v.length)&&A.value&&(A.value.value="")}),je(()=>{const v=!!(d.counter||e.counter),C=!!(v||d.details),[W,we]=qe(s),[{modelValue:Ci,...Ce}]=me.filterProps(e),[Ie]=We(e);return n(me,P({ref:g,modelValue:p.value,"onUpdate:modelValue":H=>p.value=H,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--selection-slot":!!d.selection,"v-text-field--plain-underlined":re.value},e.class],style:e.style,"onClick:prepend":be},W,Ce,{centerAffix:!re.value,focused:u.value}),{...d,default:H=>{let{id:Q,isDisabled:E,isDirty:ce,isReadonly:Se,isValid:Me}=H;return n(He,P({ref:L,"prepend-icon":e.prependIcon,onMousedown:ke,onClick:de,"onClick:clear":xe,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Ie,{id:Q.value,active:ve.value||ce.value,dirty:ce.value,disabled:E.value,focused:u.value,error:Me.value===!1}),{...d,default:Re=>{var ue;let{props:{class:Ae,...Le}}=Re;return n(x,null,[n("input",P({ref:A,type:"file",readonly:Se.value,disabled:E.value,multiple:e.multiple,name:e.name,onClick:U=>{U.stopPropagation(),se()},onChange:U=>{if(!U.target)return;const Pe=U.target;p.value=[...Pe.files??[]]},onFocus:se,onBlur:N},Le,we),null),n("div",{class:Ae},[!!((ue=p.value)!=null&&ue.length)&&(d.selection?d.selection({fileNames:o.value,totalBytes:F.value,totalBytesReadable:K.value}):e.chips?o.value.map(U=>n(le,{key:U,size:"small",color:e.color},{default:()=>[U]})):o.value.join(", "))])])}})},details:C?H=>{var Q,E;return n(x,null,[(Q=d.details)==null?void 0:Q.call(d,H),v&&n(x,null,[n("span",null,null),n(Ee,{active:!!((E=p.value)!=null&&E.length),value:b.value},d.counter)])])}:void 0})}),Ge({},g,L,A)}});const at={name:"RetrievalBox",props:{message:String},components:{Icon:te},data:function(){return{retrievalJS:null,foldedbtn:!0,loading:!1,queryData:null,retrievalData:null}},watch:{message:function(e,t){e&&(this.queryData=e)}},computed:{queryResponse(){return this.queryData&&this.queryData.response?this.queryData.response:""},querySources(){if(!this.queryData||!this.queryData.metadata)return{};const e={};return Object.values(this.queryData.metadata).filter(s=>{if(!e[s.file_path])return e[s.file_path]=!0,!0})}},created(){},methods:{}},ot={key:0},lt=w(" AI Retrieval "),rt={key:1},dt={style:{display:"flex","justify-content":"center","align-items":"flex-start",height:"20px"}},ct=w("mdi-chevron-down"),ut={class:"chips-container",style:{"margin-top":"5px"}};function ht(e,t,s,y,d,a){const p=M("Icon");return i(),m(J,{flat:""},{default:l(()=>[e.foldedbtn?(i(),c("div",ot,[n(_,{block:"",onClick:t[0]||(t[0]=u=>e.foldedbtn=!1),style:{background:"lightgrey"}},{default:l(()=>[n(p,{icon:"streamline:ai-edit-spark",style:{"font-size":"large","margin-right":"5px"}}),lt]),_:1}),e.loading?(i(),m(ee,{key:0,color:"deep-purple-accent-4",indeterminate:"",rounded:"",height:"6"})):h("",!0)])):(i(),c("div",rt,[n(J,null,{default:l(()=>[n(oe,{style:{padding:"10px"}},{default:l(()=>[r("div",dt,[n(_,{onClick:t[1]||(t[1]=u=>e.foldedbtn=!0),block:"",style:{"align-items":"start",height:"fit-content"}},{default:l(()=>[n(Z,null,{default:l(()=>[ct]),_:1})]),_:1})]),n(Y,{"hide-details":"",modelValue:a.queryResponse,"onUpdate:modelValue":t[2]||(t[2]=u=>a.queryResponse=u),"auto-grow":"",readonly:"",variant:"solo-filled"},null,8,["modelValue"]),e.loading?(i(),m(ee,{key:0,color:"deep-purple-accent-4",indeterminate:"",rounded:"",height:"6"})):h("",!0),r("div",ut,[(i(!0),c(x,null,I(a.querySources,(u,k)=>(i(),m(le,{key:k,variant:"outlined",size:"x-small","text-color":"primary",style:{"margin-bottom":"1px"}},{default:l(()=>[n(Z,{start:"",icon:"mdi-label","x-small":""}),w(" "+f(u.file_name),1)]),_:2},1024))),128))])]),_:1})]),_:1})]))]),_:1})}const mt=j(at,[["render",ht],["__scopeId","data-v-be79fc4a"]]),gt={components:{},props:{},data(){return{isAtBottom:!0}},watch:{filteredMessages(){this.isAtBottom?this.scrollToBottom():this.showNewMessage()}},computed:{},methods:{scrollToBottom(){setTimeout(()=>{const e=this.$refs.scrollContainer.$el;e.scrollTop=e.scrollHeight},300)},handleScroll(){const e=this.$refs.scrollContainer.$el;clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{const s=Math.round(e.scrollTop+e.clientHeight)+1>=e.scrollHeight;this.isAtBottom=s},200)}}};function ft(e,t,s,y,d,a){return null}const yt=j(gt,[["render",ft]]);const pt={components:{Icon:te},props:{agentInfo:Object,message:Object,totalSize:Number,currentIndex:Number},mixins:[_e],data(){return{}},mounted(){this.animateBorder()},methods:{isFileLink(e){return!!(e.includes("/FileDown")||e.includes("/readDownloadFile")||e.includes(".pdf"))},generatePreviewImage(e){const t=new URL(e),s=t.hostname;return s.includes("youtube.com")?`https://img.youtube.com/vi/${t.searchParams.get("v")}/0.jpg`:s.includes("github.com")?"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png":null}}},_t={style:{"background-color":"rgba( 255, 255, 255, 1 )"}},vt={key:0,style:{"margin-bottom":"2%"}},bt={key:0,src:q,alt:"pro",width:"50"},kt=["src"],xt={style:{"font-weight":"bold","align-self":"self-end","margin-left":"5px"}},wt={key:0},Ct={style:{margin:"15px"}},It=["src"],St={class:"ml-3"},Mt={style:{"font-weight":"bold"}},Rt=["innerHTML"],At={key:1},Lt=["innerHTML"],Pt={key:2},Vt={key:0},Tt=["innerHTML"],Ut={key:1},zt={key:0,style:{"marin-top":"20px"}},Dt={key:0,style:{"align-items":"center"}},Bt={style:{"font-weight":"bold"}},Nt=["href"],Ft={key:1,style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ot={style:{"margin-top":"20px"}},jt={style:{"font-weight":"bold"}},qt={style:{"margin-top":"auto","font-size":"x-small"}},Wt=["href"],Ht=["href"],Et=["src"],Gt={key:3},Jt={key:0,class:"d-flex align-items-center justify-content-center"},Zt={class:"text-center"},$t=["src"],Kt={style:{"font-size":"small"}},Qt=r("div",{style:{"font-size":"large",margin:"0 10px","align-self":"center"}},">>",-1),Xt={class:"text-center"},Yt=["src"],es={style:{"font-size":"small"}},ts=["innerHTML"],ss={key:4},is=["innerHTML"],ns={key:1},as=r("img",{src:q,alt:"pro",width:"50"},null,-1),os=w(" system ");function ls(e,t,s,y,d,a){const p=M("Icon");return i(),c("div",_t,[s.message?(i(),c("div",vt,[n(S,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:l(()=>[n(B,{size:"40"},{default:l(()=>[s.message.role=="system"?(i(),c("img",bt)):(i(),c("img",{key:1,src:s.message.profile,alt:"pro",width:"50"},null,8,kt))]),_:1}),r("div",xt,f(s.message.role),1)]),_:1}),r("div",{class:V(["progress-border",{animate:e.borderCompletedAnimated}])},[s.totalSize==s.currentIndex+1?(i(),c(x,{key:0},I(5,u=>r("div",{class:V(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:u},null,2)),64)):h("",!0),n(O,{class:"bg-lightsecondary rounded-md px-3 py-2"},{default:l(()=>[s.message.content.type=="agents"?(i(),c("div",wt,[r("div",Ct,'요청 주신 "'+f(s.agentInfo.draftPrompt)+'"작업을 위해서 팀 구성을 아래와 같이 하였습니다..',1),(i(!0),c(x,null,I(s.message.content.data,u=>(i(),c("div",{key:u.name,class:"d-flex align-items-start mb-3",style:{"margin-left":"5%"}},[n(B,{size:"40"},{default:l(()=>[r("img",{src:u.profile,alt:"profile",width:"50"},null,8,It)]),_:2},1024),r("div",St,[r("div",Mt,f(u.role),1),r("div",{innerHTML:u.explanation},null,8,Rt)])]))),128))])):s.message.content.type=="search"?(i(),c("div",At,[r("div",{innerHTML:s.message.content.data},null,8,Lt)])):s.message.content.type=="searchOutput"?(i(),c("div",Pt,[typeof s.message.content.data=="string"?(i(),c("div",Vt,[r("div",{innerHTML:s.message.content.data,class:"mt-2"},null,8,Tt)])):(i(),c("div",Ut,[(i(!0),c(x,null,I(s.message.content.data,u=>(i(),c("div",null,[u.link?(i(),c("div",zt,[a.isFileLink(u.link)?(i(),c("div",Dt,[r("div",Bt,[w(f(u.title)+" ",1),r("a",{href:u.link,target:"_blank",style:{"margin-right":"10px"}},[n(p,{icon:"vscode-icons:file-type-pdf2",width:"35px",height:"35px"})],8,Nt)]),r("div",null,f(u.snippet),1)])):(i(),c("div",Ft,[r("div",Ot,[r("div",jt,f(u.title),1),r("div",null,f(u.snippet),1),r("div",qt,[r("a",{href:u.link,target:"_blank",style:{color:"#0000EE","text-decoration":"underline"}},f(u.link),9,Wt)])]),r("a",{href:u.link,target:"_blank",style:{"margin-right":"10px"}},[a.generatePreviewImage(u.link)?(i(),c("img",{key:0,src:a.generatePreviewImage(u.link),alt:"preview",style:{width:"100px",height:"100px"}},null,8,Et)):h("",!0)],8,Ht)]))])):h("",!0)]))),256))]))])):s.message.content.type=="delegate"?(i(),c("div",Gt,[s.message.role!=s.message.content.delegate?(i(),c("div",Jt,[r("div",Zt,[n(B,{size:"40"},{default:l(()=>[r("img",{src:s.message.profile,alt:"profile",width:"50"},null,8,$t)]),_:1}),r("div",Kt,f(s.message.role),1)]),Qt,r("div",Xt,[n(B,{size:"40"},{default:l(()=>[r("img",{src:s.message.content.delegateProfile,alt:"profile",width:"50"},null,8,Yt)]),_:1}),r("div",es,f(s.message.content.delegate),1)])])):h("",!0),r("div",{innerHTML:s.message.content.data,class:"mt-2"},null,8,ts)])):s.message.content.type=="system"?(i(),c("div",ss,[r("div",{innerHTML:s.message.content.data},null,8,is)])):h("",!0)]),_:1}),h("",!0)],2)])):h("",!0),s.totalSize==s.currentIndex+1&&s.agentInfo.isRunning?(i(),c("div",ns,[n(S,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important","align-items":"center"}},{default:l(()=>[n(B,{size:"40",style:{"margin-right":"5px"}},{default:l(()=>[as]),_:1}),os]),_:1}),r("div",{class:V(["progress-border",{animate:e.borderCompletedAnimated}])},[r("template",null,[(i(),c(x,null,I(5,u=>r("div",{class:V(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:u},null,2)),64))]),n(O,{class:"bg-lightsecondary rounded-md px-3 py-2",style:{height:"100px"}}),n(ee,{class:"my-progress-linear",indeterminate:""})],2)])):h("",!0)])}const rs=j(pt,[["render",ls]]);const ds={props:{audioResponse:String,isLoading:Boolean,offStream:Boolean},data(){return{audio:null,mediaSource:null,sourceBuffer:null,mediaStream:null,abortController:null}},mounted(){this.setupAudioStream()},watch:{audioResponse(e){if(e==""||e==null)return;let t=e.replace(/[\n\r]/g,"");this.playResponseData(t)},offStream(e){e===!0&&this.streamOff()}},methods:{setupAudioStream(){this.audio=this.$refs.audioPlay,this.audio.autoplay=!0,this.mediaSource=new MediaSource,this.audio.src=URL.createObjectURL(this.mediaSource)},stopStream(){this.abortController&&this.abortController.abort(),this.audio&&(this.audio.pause(),this.audio.currentTime=0),this.sourceBuffer&&this.sourceBuffer.updating&&this.sourceBuffer.abort(),this.mediaSource&&this.mediaSource.readyState==="open"&&this.mediaSource.endOfStream(),this.$emit("audio:stop")},playResponseData(e){var t=this;t.abortController=new AbortController;const s=t.abortController.signal;t.sourceBuffer==null&&(t.sourceBuffer=t.mediaSource.addSourceBuffer("audio/mpeg"));var y=window.$backend==""?"http://localhost:8000":window.$backend;fetch(`${y}/audio-stream`,{method:"POST",headers:{"Content-Type":"text/plain"},body:'{"query": "'+e+'"}',signal:s}).then(d=>{const a=d.body.getReader(),p=()=>{a.read().then(({done:u,value:k})=>{if(u){t.mediaSource.endOfStream(),t.audio.onended=()=>{t.$emit("audio:stop")};return}t.sourceBuffer.updating||(t.sourceBuffer.appendBuffer(k),t.audio.play(),t.$emit("update:isLoading",!1),t.$emit("audio:start")),t.sourceBuffer.addEventListener("updateend",p,{once:!0})}).catch(u=>{console.error("Error fetching audio stream",u),t.$emit("update:isLoading",!1)})};p()}).catch(d=>{d.name==="AbortError"?console.log("Fetch aborted"):console.error("Fetch error:",d)})}}},cs={ref:"audioPlay"},us=w("정지");function hs(e,t,s,y,d,a){return i(),c("div",null,[r("audio",cs,null,512),n(_,{onClick:t[0]||(t[0]=p=>a.stopStream())},{default:l(()=>[us]),_:1})])}const ms=j(ds,[["render",hs],["__scopeId","data-v-1828d837"]]);const gs={components:{Icon:te,AudioStream:ms},props:{audioResponse:String},data(){return{audioContext:null,analyser:null,microphone:null,dataArray:null,volume:0,threshold:15,isRecording:!1,stream:null,isLoading:!1,isAudioPlaying:!1}},methods:{async getMicrophoneInput(){if(!navigator.mediaDevices){alert("브라우저가 마이크 입력을 지원하지 않습니다.");return}this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.microphone.connect(this.analyser),this.analyser.fftSize=256,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.updateVolume()},updateVolume(){if(!this.isRecording)return;this.analyser.getByteFrequencyData(this.dataArray);let e=0;for(let t=0;t<this.dataArray.length;t++)e+=this.dataArray[t];this.volume=e/this.dataArray.length,requestAnimationFrame(this.updateVolume)},boxHeight(e){return this.volume<this.threshold?20:20+(this.volume-this.threshold)/(100-this.threshold)*(e*10)},async toggleRecording(){this.isRecording?this.isRecording=!1:(this.isRecording=!0,await this.getMicrophoneInput()),this.$emit("start")},stopRecording(){this.isRecording=!1,this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.$emit("stop"),this.updateLoadingStatus(!0)},updateLoadingStatus(e){this.isLoading=e},closeRecording(){this.stopRecording(),this.$emit("close")},startAudio(){this.isAudioPlaying=!0},stopAudio(){this.isAudioPlaying=!1}},computed:{circleSize(){return this.volume<this.threshold?250:250+(this.volume-this.threshold)/(100-this.threshold)*20}}},fs=w("mdi-close"),ys={key:0,class:"loading-circle"},ps={key:1,class:"audio-bar-box"},_s={class:"controls"},vs={key:2,class:"bars"};function bs(e,t,s,y,d,a){const p=M("AudioStream"),u=M("Icon");return i(),c("div",{class:"container",style:R(e.$globalState.state.isRightZoomed?"height:100vh;":"height:calc(100vh - 155px)")},[n(_,{class:"record-close-btn",icon:"",density:"comfortable",onClick:a.closeRecording,style:R(e.$globalState.state.isRightZoomed?"top:10px;":"")},{default:l(()=>[n(Z,null,{default:l(()=>[fs]),_:1})]),_:1},8,["onClick","style"]),d.isLoading?(i(),c("div",ys,[(i(),c(x,null,I(5,k=>r("div",{class:"child-circle",key:k})),64))])):d.isAudioPlaying?(i(),c("div",ps,[(i(),c(x,null,I(4,k=>r("div",{key:k,class:V(["audio-bar","gpt-animation"+k])},null,2)),64))])):(i(),c("div",{key:2,class:"circle",style:R({width:a.circleSize+"px",height:a.circleSize+"px"})},null,4)),n(p,{"onUpdate:isLoading":a.updateLoadingStatus,"onAudio:start":a.startAudio,"onAudio:stop":a.stopAudio,audioResponse:s.audioResponse,isLoading:d.isLoading},null,8,["onUpdate:isLoading","onAudio:start","onAudio:stop","audioResponse","isLoading"]),r("div",_s,[!d.isRecording&&!d.isAudioPlaying?(i(),m(_,{key:0,onClick:a.toggleRecording,icon:"",density:"comfortable"},{default:l(()=>[n(u,{icon:"bi:mic-fill",width:"24",height:"24"})]),_:1},8,["onClick"])):(i(),m(_,{key:1,onClick:a.stopRecording,icon:"",density:"comfortable"},{default:l(()=>[n(u,{icon:"fa-solid:stop",width:"24",height:"24"})]),_:1},8,["onClick"])),d.isAudioPlaying?h("",!0):(i(),c("div",vs,[(i(),c(x,null,I(4,k=>r("div",{key:k,class:"bar",style:R({height:a.boxHeight(k)+"px"})},null,4)),64))]))])],4)}const ks=j(gs,[["render",bs],["__scopeId","data-v-d0e1b6bd"]]);const xs={components:{Icon:te,RetrievalBox:mt,AgentsChat:rs,Record:ks},mixins:[_e,yt],props:{prompt:String,name:String,messages:Array,userInfo:Object,chatInfo:Object,disableChat:Boolean,isChanged:Boolean,type:String,agentInfo:Object,userList:Array,currentChatRoom:Object,lock:Boolean,generatedWorkList:Array,ProcessGPTActive:Boolean,isAgentMode:Boolean},data(){return{workIcons:{ScheduleQuery:"solar:calendar-line-duotone",ScheduleRegistration:"solar:calendar-line-duotone",TodoListRegistration:"pajamas:overview",StartProcessInstance:"carbon:ibm-process-mining",CreateProcessDefinition:"tabler:device-imac-cog"},recordingMode:!1,defaultWorkIcon:q,displayGeneratedWorkList:!1,showGeneratedWorkList:!1,mediaRecorder:null,audioChunks:[],isRecording:!1,isReply:!1,newMessage:"",hoverIndex:-1,editIndex:-1,editText:null,replyIndex:-1,replyUser:null,isViewJSON:[],isviewJSONStatus:!1,attachedImg:null,showNewMessageNoti:!1,lastMessage:{name:"",content:""},showNewMessageNotiTimer:null,showUserList:!1,mentionStartIndex:null,mentionedUsers:[],file:null,isRender:!1}},mounted(){var e=this;document.addEventListener("click",t=>{t.target.matches(".request-file-link")&&(t.preventDefault(),e.$emit("requestFile",t.target.getAttribute("data-filename")))})},watch:{prompt(e,t){e!==t&&(this.newMessage=e,this.beforeSend())}},computed:{isSystemMentioned(){return this.mentionedUsers.some(e=>e.id==="system_id")||this.newMessage.startsWith(">")||this.newMessage.startsWith("!")},filteredUserList(){if(!this.showUserList||this.mentionStartIndex===null||!this.userList)return[];let e=this.userList.filter(s=>this.currentChatRoom.participants.some(y=>y.id===s.id));e.push({email:"system@uengine.org",id:"system_id",profile:"src/assets/images/chat/chat-icon.png",username:"System"}),e.reverse();const t=this.newMessage.substring(this.mentionStartIndex+1).toLowerCase();return e.filter(s=>s.username.toLowerCase().includes(t)&&!this.mentionedUsers.some(y=>y.id===s.id))},filteredAlert(){const e={subtitle:"",detail:""};return this.chatInfo&&(e.detail=this.$t(this.chatInfo.text)),e},filteredMessages(){var e=[];return this.messages&&this.messages.length>0&&this.messages.forEach(t=>{let s=JSON.parse(JSON.stringify(t));(s.content||s.jsonContent||s.image)&&(e.push(s),this.setRenderTime())}),e},isLoading:{get(){var e=!1;return this.messages&&this.messages.length>0&&this.messages.forEach(t=>{t.isLoading&&(e=t.isLoading)}),e},set(e){e||(this.animateBorder(),this.$emit("stopMessage"))}},disableBtn(){return this.disableChat?!0:!(this.newMessage!==""||this.attachedImg!==null)}},methods:{recordingModeChange(){this.recordingMode=!this.recordingMode,this.$globalState.methods.toggleRightZoom()},shouldDisplayGeneratedWorkList(e,t,s,y){let d=0;var a=0;this.isRender||(a=-1);for(let u=0;u<=y;u++)t[u].role!=="system"&&d++;const p=t.filter(u=>u.role==="user").length;return e==="chats"&&d-1===p+a-1&&s.length!==0},setRenderTime(){this.isRender=!1,setTimeout(()=>{this.isRender=!0},3e3)},getWorkIcon(e){return this.workIcons[e]||this.defaultWorkIcon},toggleProcessGPTActive(){this.$emit("toggleProcessGPTActive")},linkify(e){var t,s,y,d;return s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(s,'<a href="$1" target="_blank">$1</a>'),y=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(y,'$1<a href="http://$2" target="_blank">$2</a>'),d=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(d,'<a href="mailto:$1">$1</a>'),t},async startRecording(){if(this.isRecording=!0,!navigator.mediaDevices){alert("getUserMedia를 지원하지 않는 브라우저입니다.");return}const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{this.audioChunks.push(t.data)},this.mediaRecorder.start()},stopRecording(){this.isRecording=!1,this.mediaRecorder&&this.mediaRecorder.state==="recording"&&(this.mediaRecorder.stop(),this.mediaRecorder.onstop=async()=>{const e=new Blob(this.audioChunks,{type:"audio/wav"});this.uploadAudio(e)})},async uploadAudio(e){event.preventDefault();const t=new FormData;t.append("audio",e);try{var s=window.$backend==""?"http://localhost:8000":window.$backend;const d=(await ge.post(`${s}/upload`,t)).data;this.newMessage=d.transcript}catch(y){console.error("Error:",y)}},async submitFile(){if(!this.file)return;const e=new FormData;e.append("file",this.file[0]);try{var t=window.$memento==""?"http://localhost:8005":window.$memento;const s=await ge.post(`${t}/uploadfile/`,e,{headers:{"Content-Type":"multipart/form-data"}});console.log(s.data)}catch(s){console.error(s)}},openVerMangerDialog(){this.$emit("openVerMangerDialog",!0)},handleTextareaInput(e){const t=e.target.value,s=t.lastIndexOf("@");s!==-1?(this.showUserList=!0,this.mentionStartIndex=s):this.showUserList=!1,this.mentionedUsers=this.mentionedUsers.filter(y=>{const d=new RegExp(`@${y.username}`,"g");return t.match(d)}),t.startsWith(">")||t.startsWith("!")},selectUser(e){const t=this.newMessage.substring(0,this.mentionStartIndex);this.newMessage=`${t}@${e.username} `,this.showUserList=!1,this.mentionedUsers.some(s=>s.id===e.id)||this.mentionedUsers.push(e)},clickToScroll(){this.isAtBottom=!0,this.scrollToBottom(),this.showNewMessageNoti=!1,this.lastMessage={name:"",content:""}},showNewMessage(){this.messages.length>0&&this.userInfo.email!=this.messages[this.messages.length-1].email&&(this.lastMessage={name:this.messages[this.messages.length-1].name,content:this.messages[this.messages.length-1].content.length>130?this.messages[this.messages.length-1].content.substring(0,130)+"...":this.messages[this.messages.length-1].content},this.showNewMessageNoti=!0,this.showNewMessageNotiTimer&&clearTimeout(this.showNewMessageNotiTimer),this.showNewMessageNotiTimer=setTimeout(()=>{this.showNewMessageNoti=!1},5e3))},getProfile(e){if(!this.userList)return"";const t=this.userList.find(s=>s.email===e);return t?t.profile:""},shouldDisplayButtons(e,t){if(e.role!=="system"||!e.systemRequest||e.requestUserEmail!==this.userInfo.email)return!1;for(let s=t+1;s<this.filteredMessages.length;s++)if(this.filteredMessages[s].email===this.userInfo.email)return!1;return!0},shouldDisplayUserInfo(){return(e,t)=>{if(t===0)return!0;const s=this.filteredMessages[t-1];return e.email!==s.email||new Date(e.timeStamp)-new Date(s.timeStamp)>6e4}},requestDraftAgent(){this.$emit("requestDraftAgent",this.newMessage)},setMessageForUser(e){if(e.includes('"messageForUser":')){let s=fe(e).messageForUser||e;return this.linkify(s)}else return this.linkify(e)},setTableName(e){return fe(e).content||e},viewProcess(){this.$emit("viewProcess")},formatTime(e){var t=new Date(e),s=t.toString(),y=s.split(" ")[4].substring(0,5);return y},startProcess(e,t){this.$emit("startProcess",e),this.ProcessGPTActive&&this.$emit("deleteWorkList",t)},cancelProcess(e){this.$emit("cancelProcess",e)},deleteAllWorkList(){this.$emit("deleteAllWorkList")},deleteWorkList(e){this.$emit("deleteWorkList",e)},getMoreChat(){this.$emit("getMoreChat")},cancelReply(){this.isReply=!1,this.replyUser=null,this.$emit("beforeReply",!1)},beforeReply(e){this.$emit("beforeReply",e),this.isReply=!0,this.replyUser=e},beforeSend(e){if(!(e&&e.shiftKey))if(this.isAgentMode)this.requestDraftAgent(),setTimeout(()=>{this.newMessage=""},100);else{this.isLoading&&(this.isLoading=!1,this.$emit("stopMessage"));var t=this.newMessage.replace(/(?:\r\n|\r|\n)/g,"");(t.length>0||this.attachedImg!=null)&&this.send()}},send(){this.editIndex>=0?(this.$emit("sendEditedMessage",this.editIndex+1),this.editIndex=-1):this.$emit("sendMessage",{image:this.attachedImg,text:this.newMessage,mentionedUsers:this.mentionedUsers}),this.isReply&&(this.isReply=!1),this.attachedImg=null;var e=document.querySelector("#imagePreview");e.innerHTML="",this.isAtBottom=!0,setTimeout(()=>{this.newMessage="",this.mentionedUsers=[],this.showUserList=!1},100)},cancel(){this.messages[this.editIndex].content=this.editText,this.editIndex=-1},editMessage(e){e&&e>=0?this.editIndex=e:this.editIndex=-1,this.editIndex=e,this.editText=this.messages[this.editIndex].content},viewJSON(e){this.isviewJSONStatus=!this.isviewJSONStatus,this.isViewJSON.includes(e)?this.isViewJSON=this.isViewJSON.filter(t=>t!=e):this.isViewJSON.push(e)},uploadImage(){this.$refs.uploader.value="",this.attachedImg=null,this.$refs.uploader.click()},changeImage(e){const t=this,s=e.target.files[0],y=new FileReader;y.onload=d=>{const a=document.createElement("img");a.src=d.target.result,a.onload=()=>{const p=document.createElement("canvas"),u=300,k=u/a.width;p.width=u,p.height=a.height*k;const N=p.getContext("2d");N.drawImage(a,0,0,p.width,p.height);const T=N.canvas.toDataURL(a,"image/jpeg",.3);var F=`<img src=${T} width='100%' />`;$("#imagePreview").append(F),t.attachedImg=T}},s&&y.readAsDataURL(s)},capture(){this.$refs.captureImg.value="",this.attachedImg=null,this.$refs.captureImg.click()}}},ws={class:"customHeight",style:{"background-color":"rgba( 255, 255, 255, 1 )"}},Cs={key:1},Is={style:{position:"sticky",top:"0px","z-index":"1","background-color":"white"}},Ss={class:"align-right gap-3 pa-4 justify-space-between"},Ms={key:0,class:"d-flex gap-2 align-center"},Rs={class:"text-h5 mb-n1"},As={key:1,class:"d-flex gap-2 align-center"},Ls=["src"],Ps={class:"text-h5 mb-n1"},Vs={class:"textPrimary"},Ts={style:{"white-space":"pre-line"}},Us={key:1},zs={key:0},Ds={key:0,class:"text-medium-emphasis text-subtitle-2 mr-2"},Bs=["src"],Ns={key:0,class:"bg-lightprimary",style:{"border-radius":"10px"}},Fs=["onMouseover"],Os={key:0,class:"text-body-1"},js={key:1,class:"text-body-1"},qs=["innerHTML"],Ws={key:4,class:"text-body-1"},Hs=r("img",{src:q,style:{height:"24px"}},null,-1),Es=[Hs],Gs={class:"w-100"},Js=["src"],Zs={key:1,style:{"padding-top":"2px"}},$s={style:{"margin-left":"5px","margin-top":"0px"}},Ks={key:0,class:"mt-2 w-100"},Qs={key:0,class:"align-items-start gap-3 mb-1 w-100"},Xs={key:0,src:q,"max-height":"48","max-width":"48"},Ys={key:0,style:{"font-size":"12px","padding-top":"20px"}},ei={class:"w-100 pb-5"},ti=["src"],si={key:0,class:"text-body-1"},ii={key:1,class:"text-body-1"},ni={class:"text-body-1"},ai={key:3,style:{"margin-top":"5px"}},oi=w("y"),li=w("n"),ri={key:0},di=["innerHTML"],ci=w("Memento"),ui={class:"chips-container",style:{"margin-top":"5px"}},hi={key:6,class:"text-body-1"},mi={style:{position:"relative"}},gi={key:0,class:"text-body-1",style:{"margin-left":"10px"}},fi=w("mdi-close"),yi=r("div",{id:"imagePreview",style:{"max-width":"200px"}},null,-1),pi={class:"d-flex align-center pa-0"},_i={style:{height:"-webkit-fill-available","margin-right":"10px","margin-top":"10px"}},vi={key:0,class:"user-list",style:{position:"absolute",bottom:"16%",left:"0","background-color":"white","z-index":"100"}},bi=["onClick"],ki=["src"],xi={style:{"font-size":"0.8em",color:"#666"}};function wi(e,t,s,y,d,a){const p=M("Record"),u=M("Icon"),k=M("AgentsChat"),N=M("SendIcon"),T=M("v-list-item-content"),F=M("v-list-item-group"),K=M("perfect-scrollbar");return i(),c("div",ws,[d.recordingMode?(i(),m(p,{key:0,onClose:t[0]||(t[0]=o=>a.recordingModeChange()),onStart:t[1]||(t[1]=o=>a.startRecording()),onStop:t[2]||(t[2]=o=>a.stopRecording()),audioResponse:d.newMessage},null,8,["audioResponse"])):(i(),c("div",Cs,[r("div",null,[r("div",null,[ne(e.$slots,"custom-title",{},()=>[r("div",Is,[r("div",Ss,[s.name&&s.name!==""?(i(),c("div",Ms,[r("div",null,[r("h5",Rs,f(s.name),1)])])):s.chatInfo?(i(),c("div",As,[s.chatInfo.img?(i(),m(B,{key:0},{default:l(()=>[r("img",{src:s.chatInfo.img,width:"50"},null,8,Ls)]),_:1})):h("",!0),r("div",null,[r("h5",Ps,f(e.$t(s.chatInfo.title)),1),r("small",Vs,f(a.filteredAlert.subtitle),1)])])):h("",!0),ne(e.$slots,"custom-tools")]),s.name&&s.name!==""||s.chatInfo||s.type=="form"?(i(),m(D,{key:0,style:{margin:"0px"}})):h("",!0)])]),n(K,{class:"h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:l(()=>[r("div",{class:"d-flex w-100",style:R(e.$globalState.state.isRightZoomed?"height:100vh;":"height:calc(100vh - 307px)")},[n(ae,null,{default:l(()=>[a.filteredAlert.detail?(i(),m(st,{key:0,color:"#2196F3",variant:"outlined"},{title:l(()=>[n(u,{style:{"margin-left":"-6px"},icon:"clarity:info-line",width:"32",height:"32"})]),default:l(()=>[r("small",Ts,f(a.filteredAlert.detail),1)]),_:1})):h("",!0),(i(!0),c(x,null,I(a.filteredMessages,(o,b)=>(i(),c("div",{key:b,class:"px-1 py-1"},[o&&o._template==="agent"?(i(),m(k,{key:0,message:o,agentInfo:s.agentInfo,totalSize:a.filteredMessages.length,currentIndex:b},null,8,["message","agentInfo","totalSize","currentIndex"])):(i(),c("div",Us,[r("div",null,[o.email==s.userInfo.email&&o.role!="system"?(i(),c("div",zs,[n(S,{class:"ma-0 pa-0"},{default:l(()=>[n(X),o.timeStamp?(i(),c("small",Ds,f(a.formatTime(o.timeStamp)),1)):h("",!0),o.image?(i(),m(O,{key:1,class:"mb-1"},{default:l(()=>[r("img",{src:o.image,class:"rounded-md",alt:"pro",width:"250"},null,8,Bs)]),_:2},1024)):h("",!0)]),_:2},1024),d.editIndex===b?(i(),c("div",Ns,[n(Y,{modelValue:s.messages[b].content,"onUpdate:modelValue":g=>s.messages[b].content=g,variant:"solo","hide-details":"","bg-color":"lightprimary",class:"shadow-none",density:"compact","auto-grow":"",rows:"1",autofocus:""},null,8,["modelValue","onUpdate:modelValue"]),n(S,{class:"pa-0 ma-0 mr-2 pb-2"},{default:l(()=>[n(X),n(_,{onClick:a.send,class:"text-medium-emphasis",icon:"",variant:"text",size:"x-small",style:{"background-color":"white !important","margin-right":"5px"}},{default:l(()=>[n(N,{size:"20"})]),_:1},8,["onClick"]),n(_,{onClick:a.cancel,class:"text-medium-emphasis",icon:"",variant:"text",size:"x-small",style:{"background-color":"white !important"}},{default:l(()=>[n(u,{icon:"solar:backspace-bold",height:"20",width:"20"})]),_:1},8,["onClick"])]),_:1})])):(i(),c("div",{key:1,class:"d-flex justify-end",onMouseover:g=>d.hoverIndex=b,onMouseleave:t[4]||(t[4]=g=>d.hoverIndex=-1)},[n(O,{class:"bg-lightprimary rounded-md px-3 py-2 mb-1"},{default:l(()=>[o.replyUserName?(i(),c("pre",Os,f(o.replyUserName),1)):h("",!0),o.replyContent?(i(),c("pre",js,f(o.replyContent),1)):h("",!0),o.replyContent?(i(),m(D,{key:2})):h("",!0),o.content?(i(),c("pre",{key:3,class:"text-body-1",innerHTML:a.linkify(o.content)},null,8,qs)):h("",!0),o.jsonContent?(i(),c("pre",Ws,f(o.jsonContent),1)):h("",!0),n(S,{class:"ma-0 pa-0"},{default:l(()=>[n(X),d.hoverIndex===b&&!s.disableChat?(i(),m(_,{key:0,onClick:g=>a.editMessage(b),icon:"",variant:"text",size:"x-small",class:"float-left edit-btn",style:{"background-color":"white"}},{default:l(()=>[n(u,{icon:"solar:pen-bold",height:"20",width:"20"})]),_:2},1032,["onClick"])):h("",!0)]),_:2},1024)]),_:2},1024),a.shouldDisplayGeneratedWorkList(s.type,a.filteredMessages,s.generatedWorkList,b)?(i(),c("div",{key:d.isRender},[r("div",{onClick:t[3]||(t[3]=g=>d.showGeneratedWorkList=!d.showGeneratedWorkList),class:"find-message",style:R(s.generatedWorkList.length?"opacity:1":"opacity0.4")},Es,4)])):h("",!0)],40,Fs)),d.showGeneratedWorkList&&a.shouldDisplayGeneratedWorkList(s.type,a.filteredMessages,s.generatedWorkList,b)?(i(),m(J,{key:2,class:"mt-3"},{default:l(()=>[n(_,{onClick:t[5]||(t[5]=g=>a.deleteAllWorkList()),size:"small",icon:"",density:"comfortable",style:{position:"absolute",right:"5px",top:"5px","z-index":"1"}},{default:l(()=>[n(u,{icon:"el:trash"})]),_:1}),n($e,null,{default:l(()=>[n(F,null,{default:l(()=>[(i(!0),c(x,null,I(s.generatedWorkList,(g,L)=>(i(),m(Ke,{key:L,class:"d-flex align-items-center"},{default:l(()=>[g.messageForUser?(i(),m(T,{key:0,class:"flex-grow-1 d-flex align-items-center"},{default:l(()=>[r("div",Gs,[n(S,{class:"ma-0 pa-3"},{default:l(()=>[d.workIcons[g.work]?(i(),c("div",Zs,[n(u,{icon:a.getWorkIcon(g.work)},null,8,["icon"])])):(i(),c("img",{key:0,src:d.defaultWorkIcon,alt:"Default Icon",style:{width:"20px",height:"20px"}},null,8,Js)),r("div",$s,f(g.messageForUser),1),r("div",null,[n(_,{onClick:A=>g.expanded=!g.expanded,class:"ml-2",size:"small",icon:"",density:"comfortable"},{default:l(()=>[n(u,{icon:g.expanded?"iconamoon:arrow-up-2":"iconamoon:arrow-down-2",width:"24",height:"24"},null,8,["icon"])]),_:2},1032,["onClick"]),n(_,{onClick:A=>a.startProcess(g,L),class:"ml-2",size:"small",icon:"",density:"comfortable"},{default:l(()=>[n(u,{icon:"gridicons:play",width:"24",height:"24"})]),_:2},1032,["onClick"])])]),_:2},1024),n(Qe,null,{default:l(()=>[g.expanded?(i(),c("div",Ks,[r("pre",null,f(g),1)])):h("",!0)]),_:2},1024),g.work=="CreateProcessDefinition"?(i(),m(ye,{key:0,width:300,"aspect-ratio":"16/9",cover:"",src:"https://github.com/jhyg/project-shop-test/assets/65217813/1b551056-0428-41b6-9b90-76dd7942affc"})):h("",!0)])]),_:2},1024)):h("",!0),L<s.generatedWorkList.length-1?(i(),m(D,{key:1})):h("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0)])):(i(),c("div",{key:1,style:R(a.shouldDisplayUserInfo(o,b)?"":"margin-top: -20px;")},[a.shouldDisplayUserInfo(o,b)?(i(),c("div",Qs,[n(S,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:l(()=>[n(B,{style:{"margin-right":"10px"}},{default:l(()=>[o.role=="system"?(i(),c("img",Xs)):(i(),m(ye,{key:1,src:a.getProfile(o.email),alt:o.name,height:"48",width:"48"},null,8,["src","alt"]))]),_:2},1024),o.timeStamp?(i(),c("div",Ys,f(o.role=="system"?"System,":o.name+",")+" "+f(a.formatTime(o.timeStamp)),1)):h("",!0)]),_:2},1024)])):h("",!0),r("div",ei,[o.image?(i(),m(O,{key:0,class:"mb-1"},{default:l(()=>[r("img",{src:o.image,class:"rounded-md",alt:"pro",width:"250"},null,8,ti)]),_:2},1024)):h("",!0),r("div",{class:V(["progress-border",{animate:e.borderCompletedAnimated}])},[o.role=="system"&&a.filteredMessages.length-1==b?(i(),c(x,{key:0},I(5,g=>r("div",{class:V(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:g},null,2)),64)):h("",!0),o.content?(i(),m(O,{key:1,class:"bg-lightsecondary rounded-md px-3 py-2",onMouseover:g=>d.replyIndex=b,onMouseleave:t[6]||(t[6]=g=>d.replyIndex=-1)},{default:l(()=>[o.replyUserName?(i(),c("pre",si,f(o.replyUserName),1)):h("",!0),o.replyContent?(i(),c("pre",ii,f(o.replyContent),1)):h("",!0),o.replyContent?(i(),m(D,{key:2})):h("",!0),r("pre",ni,f(a.setMessageForUser(o.content)),1),a.shouldDisplayButtons(o,b)?(i(),c("p",ai,[n(_,{style:{"margin-right":"5px"},size:"small",onClick:g=>a.startProcess(o)},{default:l(()=>[oi]),_:2},1032,["onClick"]),n(_,{size:"small",onClick:g=>a.cancelProcess(o)},{default:l(()=>[li]),_:2},1032,["onClick"])])):h("",!0),n(S,{class:"pa-0 ma-0"},{default:l(()=>[n(X),d.replyIndex===b?(i(),c("div",ri,[n(_,{onClick:g=>a.beforeReply(o),variant:"text",size:"x-small",icon:"",style:{"background-color":"white","margin-right":"5px"}},{default:l(()=>[n(u,{icon:"material-symbols:reply",width:"20",height:"20"})]),_:2},1032,["onClick"]),n(_,{onClick:g=>a.viewJSON(b),variant:"text",size:"x-small",icon:"",style:{"background-color":"white"}},{default:l(()=>[o.jsonContent&&d.isviewJSONStatus?(i(),m(u,{key:0,icon:"iconamoon:arrow-up-2",width:"20",height:"20"})):(i(),m(u,{key:1,icon:"iconamoon:arrow-down-2",width:"20",height:"20"}))]),_:2},1032,["onClick"])])):h("",!0)]),_:2},1024),o.tableData?(i(),m(S,{key:4,class:"my-5"},{default:l(()=>[n(ae,{cols:"12"},{default:l(()=>[n(J,{outlined:""},{default:l(()=>[n(pe,null,{default:l(()=>[w(f(a.setTableName(o.content)),1)]),_:2},1024),n(oe,null,{default:l(()=>[r("div",{innerHTML:o.tableData,class:"table-responsive"},null,8,di)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0),o.memento?(i(),m(S,{key:5,class:"my-5"},{default:l(()=>[n(ae,{cols:"12"},{default:l(()=>[n(J,{outlined:""},{default:l(()=>[n(pe,null,{default:l(()=>[ci]),_:1}),n(oe,null,{default:l(()=>[n(Y,{"hide-details":"",modelValue:o.memento.response,"onUpdate:modelValue":g=>o.memento.response=g,"auto-grow":"",readonly:"",variant:"solo-filled"},null,8,["modelValue","onUpdate:modelValue"]),r("div",ui,[(i(!0),c(x,null,I(o.memento.sources,(g,L)=>(i(),m(le,{key:L,variant:"outlined",size:"x-small","text-color":"primary",style:{"margin-bottom":"1px"}},{default:l(()=>[n(Z,{start:"",icon:"mdi-label","x-small":""}),w(" "+f(g.file_name),1)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0),d.isViewJSON.includes(b)?(i(),c("pre",hi,f(o.jsonContent)+`
                                                            `,1)):h("",!0)]),_:2},1032,["onMouseover"])):h("",!0),o.role=="system"&&a.filteredMessages.length-1==b&&a.isLoading?(i(),m(ee,{key:2,indeterminate:"",class:"my-progress-linear"})):h("",!0)],2)])],4))])])),s.type=="instances"&&s.agentInfo.isRunning&&a.filteredMessages.length==0?(i(),m(k,{key:2,class:"px-5 py-1",agentInfo:s.agentInfo,totalSize:a.filteredMessages.length,currentIndex:-1},null,8,["agentInfo","totalSize"])):h("",!0)]))),128)),ne(e.$slots,"custom-chat")]),_:3})],4)]),_:3},8,["onScroll"]),r("div",mi,[n(S,{class:"pa-0 ma-0",style:{position:"absolute",bottom:"0px",left:"0px"}},{default:l(()=>[n(G,{text:"카메라"},{activator:l(({props:o})=>[n(_,P({icon:"",variant:"text",class:"text-medium-emphasis",onClick:a.capture},o,{style:{width:"30px",height:"30px","margin-left":"5px"},disabled:s.disableChat}),{default:l(()=>[n(u,{icon:"iconoir:camera",width:"20",height:"20"})]),_:2},1040,["onClick","disabled"])]),_:1}),n(G,{text:e.$t("chat.addImage")},{activator:l(({props:o})=>[n(_,P({icon:"",variant:"text",class:"text-medium-emphasis",onClick:a.uploadImage},o,{style:{width:"30px",height:"30px","margin-left":"5px"},disabled:s.disableChat}),{default:l(()=>[n(u,{icon:"iconoir:add-media-image",width:"20",height:"20"})]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"]),n(G,{text:"Draft Agent"},{activator:l(({props:o})=>[(s.type=="instances"||s.type=="chats")&&!s.agentInfo.isRunning?(i(),m(_,P({key:0,disabled:!(d.newMessage||s.agentInfo.draftPrompt),icon:"",variant:"text",class:"text-medium-emphasis",onClick:a.requestDraftAgent},o,{style:{width:"30px",height:"30px",margin:"1px 0px 0px 5px"}}),{default:l(()=>[n(u,{icon:"fluent:document-one-page-sparkle-16-regular",width:"20",height:"20"})]),_:2},1040,["disabled","onClick"])):h("",!0),(s.type=="instances"||s.type=="chats")&&s.agentInfo.isRunning?(i(),m(_,{key:1,icon:"",variant:"text",class:"text-medium-emphasis",style:{width:"30px",height:"30px"}},{default:l(()=>[n(Xe,{size:20,indeterminate:"",color:"primary"})]),_:1})):h("",!0)]),_:1}),(s.type=="instances"||s.type=="chats")&&!s.agentInfo.isRunning?(i(),m(et,{key:0,ref:"uploadForm",onSubmit:Ye(a.submitFile,["prevent"]),style:{height:"30px"},class:"chat-selected-file"},{default:l(()=>[n(S,{class:"ma-0 pa-0",style:R(d.file&&d.file.length>0?"margin:-13px 0px 0px 7px !important;":"")},{default:l(()=>[n(G,{text:e.$t("chat.fileUpLoad")},{activator:l(({props:o})=>[d.file&&d.file.length>0?(i(),m(_,P({key:0,type:"submit"},o,{icon:"",variant:"text",class:"text-medium-emphasis",style:{width:"30px",height:"30px",margin:"12.5px 0px 0px 0px"}}),{default:l(()=>[n(u,{icon:"material-symbols:upload",width:"24",height:"24"})]),_:2},1040)):h("",!0)]),_:1},8,["text"]),n(nt,{class:V(["chat-file-up-load",{"chat-file-up-load-display":d.file&&d.file.length>0}]),style:R(d.file&&d.file.length>0?"":"padding:5px 0px 0px 8px !important; width:30px !important; height:30px !important;"),modelValue:d.file,"onUpdate:modelValue":t[7]||(t[7]=o=>d.file=o),label:"Choose a file","prepend-icon":"mdi-paperclip",outlined:""},null,8,["class","style","modelValue"]),s.type=="chats"?(i(),m(G,{key:0,text:s.ProcessGPTActive?e.$t("chat.isDisableProcessGPT"):e.$t("chat.isEnableProcessGPT")},{activator:l(({props:o})=>[n(_,P({icon:"",variant:"text",class:"text-medium-emphasis",onClick:a.toggleProcessGPTActive},o,{style:{width:"30px",height:"30px","margin-left":"12px"},disabled:s.disableChat}),{default:l(()=>[r("img",{style:R([s.ProcessGPTActive?"opacity:1":"opacity:0.5",{height:"24px"}]),src:q},null,4)]),_:2},1040,["onClick","disabled"])]),_:1},8,["text"])):h("",!0)]),_:1},8,["style"])]),_:1},8,["onSubmit"])):h("",!0)]),_:1})])]),n(D)]),n(D),d.isReply?(i(),c("div",gi,[w(f(d.replyUser.name)+"님에게 답장 ",1),n(Z,{onClick:t[8]||(t[8]=o=>a.cancelReply())},{default:l(()=>[fi]),_:1}),r("p",null,f(d.replyUser.content),1),n(D)])):h("",!0),r("input",{type:"file",accept:"image/*",capture:"camera",ref:"captureImg",class:"d-none",onChange:t[9]||(t[9]=(...o)=>a.changeImage&&a.changeImage(...o))},null,544),r("input",{type:"file",accept:"image/*",ref:"uploader",class:"d-none",onChange:t[10]||(t[10]=(...o)=>a.changeImage&&a.changeImage(...o))},null,544),yi,r("form",pi,[n(Y,{variant:"solo","hide-details":"",modelValue:d.newMessage,"onUpdate:modelValue":t[13]||(t[13]=o=>d.newMessage=o),color:"primary",class:"shadow-none message-input-box cp-chat",density:"compact",placeholder:e.$t("chat.inputMessage"),"auto-grow":"",rows:"1",onKeypress:tt(a.beforeSend,["enter"]),disabled:s.disableChat,style:{"font-size":"20px !important"},onInput:a.handleTextareaInput},{"prepend-inner":l(()=>[n(_,{onClick:t[11]||(t[11]=o=>a.recordingModeChange()),density:"comfortable",icon:""},{default:l(()=>[n(u,{icon:"ic:round-headset",width:"24",height:"24"})]),_:1})]),"append-inner":l(()=>[r("div",_i,[a.isLoading?(i(),m(_,{key:1,icon:"",variant:"text",onClick:t[12]||(t[12]=o=>a.isLoading=!a.isLoading),style:{width:"30px",height:"30px"}},{default:l(()=>[n(u,{icon:"ic:outline-stop-circle",width:"20",height:"20"})]),_:1})):(i(),m(_,{key:0,class:"cp-send",icon:"",variant:"text",type:"submit",onClick:a.beforeSend,style:{width:"30px",height:"30px"},disabled:a.disableBtn},{default:l(()=>[n(u,{icon:"teenyicons:send-outline",width:"20",height:"20"})]),_:1},8,["onClick","disabled"]))])]),_:1},8,["modelValue","placeholder","onKeypress","disabled","onInput"]),d.showUserList?(i(),c("div",vi,[(i(!0),c(x,null,I(a.filteredUserList,o=>(i(),c("div",{key:o.id,onClick:b=>a.selectUser(o),class:"user-item",style:{display:"flex","align-items":"center",padding:"10px",cursor:"pointer"}},[r("img",{src:o.profile,alt:"profile",style:{width:"30px",height:"30px","border-radius":"50%","margin-right":"10px"}},null,8,ki),r("div",null,[r("div",null,f(o.username),1),r("div",xi,f(o.email),1)])],8,bi))),128))])):h("",!0)])]))])}const Ai=j(xs,[["render",wi]]);export{Ai as C,nt as V};
