import{_ as A,K as B,s as v,o as l,c,a as n,b as d,w as p,L as b,M as w,aj as P,R as k,z as f,A as C,F as y,d as $,x as S,aE as R,$ as O,V as x,aF as E,aG as N,ay as D,al as F}from"./index-dcd728bc.js";import{P as U,_ as T}from"./chat-icon-7da84487.js";import{V}from"./VSheet-42154d36.js";import{_ as J}from"./AppBaseCard.vue_vue_type_style_index_0_lang-86309e8f.js";import{_ as G,a as K}from"./ChatProfile-d853de6b.js";/* empty css                                                    */import"./index-18289fd3.js";const Q={components:{Icon:B},mixins:[U],data(){return{inputRegex:/Agent: ([^\n|]+)[|\n]Tool: ([^\n|]+)[|\n]Input: ([\s\S]+)/,outputRegex:/Agent: ([^\n]+)\nTool Output: ([\s\S]+)/,newMessage:"",ws:null,isConnection:!1,isRunning:!1,result:null}},watch:{},mounted(){this.animateBorder(),this.receiveAgent()},methods:{isFileLink(e){return!!(e.includes("/FileDown")||e.includes("/readDownloadFile")||e.includes(".pdf"))},generatePreviewImage(e){const o=new URL(e),t=o.hostname;return t.includes("youtube.com")?`https://img.youtube.com/vi/${o.searchParams.get("v")}/0.jpg`:t.includes("github.com")?"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png":null},receiveAgent(){var e=this,o=window.$autonomous==""?"localhost:6789":window.$autonomous;e.ws=new WebSocket(`ws://${o}`),e.ws.onopen=()=>{e.isConnection=!0},e.ws.onmessage=t=>{e.isRunning=!0,e.animateBorder(),this.result||(this.result={}),this.result.chats||(this.result.chats=[]);let a=null;if(!t.data.startsWith("Chain started with inputs: "))if(t.data.includes("{'text': ")||t.data.includes("You are a tool for")||t.data.includes("{'topic'"))t.data.includes("{'topic'")&&(e.result.topic=this.parseJsonString(t.data));else if(t.data.includes("Prompt after formatting:")){var r=t.data.indexOf("Current summary:");r!==-1&&t.data.substring(r).replace(/\n/g,"<br>")}else if(t.data.includes('"agents":'))try{let u=JSON.parse(t.data);e.result.agents=u.agents.map((m,g)=>({...m,profile:`/src/assets/images/profile/user-${g+1}.jpg`})),e.result.tools={"Search the internet":"인터넷 검색","Search Internal Documents":"외부 문서 검색","Search news on the internet":"인터넷 뉴스 검색"},a=e.convertAgentsContent(t.data,e.result.agents)}catch(u){console.error("Error parsing JSON:",u)}else t.data.match(e.inputRegex)?a=e.convertInputContent(t.data,e.result.agents,e.result.tools):t.data.match(e.outputRegex)?a=e.convertSearchOutputContent(t.data,e.result.agents):a=e.convertSystemContent(t.data);a&&(e.result.chats.push(a),e.isRunning=!1)},e.ws.onclose=()=>{e.isConnection=!1}},convertSystemContent(e){if(!e)return null;const o=/(출처:\s*https?:\/\/[^\s]+)/g;var t=e.replace(/\n/g,"<br>");return t.replace(o,a=>`<a href="${a.replace("출처:","").trim()}" target="_blank">${a}</a>`),{action:"system",name:"System",role:"system",email:"system@uengine.org",content:t,profile:"@/assets/images/chat/chat-icon.png",timeStamp:1708491834047}},convertAgentsContent(e,o){return e?(o||(o=[]),typeof e=="string"&&(e=JSON.parse(e)),{action:"agents",name:"System",role:"system",email:"agent@uengine.org",content:o.map((a,r)=>({...a,explanation:`${a.name}은 ${a.backstory}을 바탕으로 ${a.goal}을 목표를 가진다.<br/><br/>${e.tasks.filter(u=>u.agent===a.name).map(u=>`* 업무내용 <br/> - ${u.description}`).join(`
`)||""}`})),profile:"@/assets/images/chat/chat-icon.png",timeStamp:1708491834047}):null},convertInputContent(e,o,t){if(!e)return null;o||(o=[]),t||(t={});const a=e.match(this.inputRegex),r=a[1],u=a[2],m=a[3],g=t&&t[u]?t[u]:u,h=o.find(i=>i.role==r||i.name==r),s=h?h.profile:"/src/assets/images/profile/user-9.jpg";let _={};if(m.includes("|")&&(g.toLowerCase().includes("delegate")||g.toLowerCase().includes("co-worker"))){let i=m.split("|"),M=i[0],j=i[1],z=i[2],L=o.find(I=>I.role==M||I.name==M),H=`
                    <h3>${j}</h3>
                    <p>${z}</p>
                `;_={action:"delegate",name:r,role:r,delegate:M,delegateProfile:L?L.profile:"/src/assets/images/profile/user-9.jpg",email:"agent@uengine.org",content:H,profile:s,timeStamp:1708491834047}}else{let i=`"${m}"을(를) ${g}...`;_={action:"search",name:r,role:r,email:"agent@uengine.org",content:i,profile:s,timeStamp:1708491834047}}return _},convertSearchOutputContent(e,o){if(!e)return null;o||(o=[]);const t=e.match(this.outputRegex),a=t?t[1]:"Unknown",r=o.find(g=>g.role==a||g.name==a),u=r?r.profile:"/src/assets/images/profile/user-9.jpg";let m=null;return t[2].includes("-----------------")?(m||(m=[]),t[2].split(`-----------------
`).filter(h=>h.trim()!=="").forEach(h=>{const s=h.match(/Title: (.+)/),_=h.match(/Link: (.+)/),i=h.match(/Snippet: (.+)/);s&&_&&i&&m.push({title:s[1],link:_[1],snippet:i[1]})})):m=t[2].replace(/\n/g,"<br>"),{action:"searchOutput",name:a,role:a,email:"agent@uengine.org",content:m,data:e,profile:u,timeStamp:1708491834047}},transformLinks(e){const o=/(출처:\s*https?:\/\/[^\s]+)/g;return e.replace(o,t=>`<a href="${t.replace("출처:","").trim()}" target="_blank">${t}</a>`)},parseJsonString(e){try{const o=e.replace(/'/g,'"').replace(/\\n/g,"\\n");return JSON.parse(o)}catch{return e}},sendMessage(){this.isRunning=!0,this.ws.send(this.newMessage)}}},W={class:"customHeight",style:{"background-color":"rgba( 255, 255, 255, 1 )"}},Y={class:"d-flex",style:{"padding-bottom":"20px"}},q={class:"w-100",style:{height:"calc(100vh - 320px)"}},X={key:0,src:T,alt:"pro",width:"50"},Z=["src"],ee={style:{"font-weight":"bold","align-self":"self-end","margin-left":"5px"}},te={key:0},se={style:{margin:"15px"}},ne=["src"],oe={class:"ml-3"},ie={style:{"font-weight":"bold"}},re=["innerHTML"],ae={key:1},le=["innerHTML"],ce={key:2},de={key:0},ue=["innerHTML"],pe={key:1},me={key:0,style:{"marin-top":"20px"}},ge={key:0,style:{"align-items":"center"}},he={style:{"font-weight":"bold"}},fe=["href"],_e={key:1,style:{display:"flex","align-items":"center","justify-content":"space-between"}},ye={style:{"margin-top":"20px"}},ve={style:{"font-weight":"bold"}},be={style:{"margin-top":"auto","font-size":"x-small"}},we=["href"],ke=["href"],Ce=["src"],Se={key:3},Me={key:0,class:"d-flex align-items-center justify-content-center"},xe={class:"text-center"},Le=["src"],Ie={style:{"font-size":"small"}},Pe=n("div",{style:{"font-size":"large",margin:"0 10px","align-self":"center"}},">>",-1),Re={class:"text-center"},Ve=["src"],Ae={style:{"font-size":"small"}},$e=["innerHTML"],Te={key:4},je=["innerHTML"],ze={key:1,style:{margin:"5%"}},He=n("img",{src:T,alt:"pro",width:"50"},null,-1),Be=$(" system "),Oe={class:"d-flex align-center pa-0"},Ee=n("div",{id:"imagePreview",style:{"max-width":"300px"}},null,-1);function Ne(e,o,t,a,r,u){const m=v("Icon"),g=v("perfect-scrollbar"),h=v("PhotoIcon");return l(),c("div",W,[n("div",null,[d(g,{class:"rightpartHeight h-100",ref:"scrollContainer",onScroll:e.handleScroll},{default:p(()=>[n("div",Y,[n("div",q,[r.result?(l(!0),c(b,{key:0},w(r.result.chats,(s,_)=>(l(),c("div",{key:s.id,style:{margin:"5%"}},[d(P,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important"}},{default:p(()=>[d(k,{size:"40"},{default:p(()=>[s.role=="system"?(l(),c("img",X)):(l(),c("img",{key:1,src:s.profile,alt:"pro",width:"50"},null,8,Z))]),_:2},1024),n("div",ee,f(s.role),1)]),_:2},1024),n("div",{class:C(["progress-border",{animate:e.borderCompletedAnimated}])},[r.result.chats.length-1==_?(l(),c(b,{key:0},w(5,i=>n("div",{class:C(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:i},null,2)),64)):y("",!0),d(V,{class:"bg-lightsecondary rounded-md px-3 py-2"},{default:p(()=>[s.action=="agents"?(l(),c("div",te,[n("div",se,'요청 주신 "'+f(r.newMessage)+'"작업을 위해서 팀 구성을 아래와 같이 하였습니다.',1),(l(!0),c(b,null,w(s.content,i=>(l(),c("div",{key:i.name,class:"d-flex align-items-start mb-3",style:{"margin-left":"5%"}},[d(k,{size:"40"},{default:p(()=>[n("img",{src:i.profile,alt:"profile",width:"50"},null,8,ne)]),_:2},1024),n("div",oe,[n("div",ie,f(i.role),1),n("div",{innerHTML:i.explanation},null,8,re)])]))),128))])):s.action=="search"?(l(),c("div",ae,[n("div",{innerHTML:s.content},null,8,le)])):s.action=="searchOutput"?(l(),c("div",ce,[typeof s.content=="string"?(l(),c("div",de,[n("div",{innerHTML:s.content,class:"mt-2"},null,8,ue)])):(l(),c("div",pe,[(l(!0),c(b,null,w(s.content,i=>(l(),c("div",null,[i.link?(l(),c("div",me,[u.isFileLink(i.link)?(l(),c("div",ge,[n("div",he,[$(f(i.title)+" ",1),n("a",{href:s.content.link,target:"_blank",style:{"margin-right":"10px"}},[d(m,{icon:"vscode-icons:file-type-pdf2",width:"35px",height:"35px"})],8,fe)]),n("div",null,f(i.snippet),1)])):(l(),c("div",_e,[n("div",ye,[n("div",ve,f(i.title),1),n("div",null,f(i.snippet),1),n("div",be,[n("a",{href:i.link,target:"_blank",style:{color:"#0000EE","text-decoration":"underline"}},f(i.link),9,we)])]),n("a",{href:i.link,target:"_blank",style:{"margin-right":"10px"}},[u.generatePreviewImage(i.link)?(l(),c("img",{key:0,src:u.generatePreviewImage(i.link),alt:"preview",style:{width:"100px",height:"100px"}},null,8,Ce)):y("",!0)],8,ke)]))])):y("",!0)]))),256))]))])):s.action=="delegate"?(l(),c("div",Se,[s.role!=s.delegate?(l(),c("div",Me,[n("div",xe,[d(k,{size:"40"},{default:p(()=>[n("img",{src:s.profile,alt:"profile",width:"50"},null,8,Le)]),_:2},1024),n("div",Ie,f(s.role),1)]),Pe,n("div",Re,[d(k,{size:"40"},{default:p(()=>[n("img",{src:s.delegateProfile,alt:"profile",width:"50"},null,8,Ve)]),_:2},1024),n("div",Ae,f(s.delegate),1)])])):y("",!0),n("div",{innerHTML:s.content,class:"mt-2"},null,8,$e)])):s.action=="system"?(l(),c("div",Te,[n("div",{innerHTML:s.content},null,8,je)])):y("",!0)]),_:2},1024),r.result.chats.length-1==_&&r.isConnection?(l(),S(R,{key:1,indeterminate:"",class:"my-progress-linear"})):y("",!0)],2)]))),128)):y("",!0),r.result&&r.result.chats.length==0&&r.isRunning?(l(),c("div",ze,[d(P,{class:"ma-0 pa-0",style:{"margin-bottom":"10px !important","align-items":"center"}},{default:p(()=>[d(k,{size:"40",style:{"margin-right":"5px"}},{default:p(()=>[He]),_:1}),Be]),_:1}),n("div",{class:C(["progress-border",{animate:e.borderCompletedAnimated}])},[n("template",null,[(l(),c(b,null,w(5,s=>n("div",{class:C(["progress-border-span",{opacity:!e.borderCompletedAnimated}]),key:s},null,2)),64))]),d(V,{class:"bg-lightsecondary rounded-md px-3 py-2",style:{height:"100px"}}),d(R,{indeterminate:"",class:"my-progress-linear"})],2)])):y("",!0)])])]),_:1},8,["onScroll"])]),d(O),n("form",Oe,[n("input",{type:"file",accept:"image/*",ref:"uploader",class:"d-none",onChange:o[0]||(o[0]=(...s)=>e.changeImage&&e.changeImage(...s))},null,544),Ee,d(D,{variant:"solo","hide-details":"",modelValue:r.newMessage,"onUpdate:modelValue":o[2]||(o[2]=s=>r.newMessage=s),color:"primary",class:"shadow-none",density:"compact",placeholder:e.$t("chat.inputMessage"),"auto-grow":"",rows:"1",onKeydown:o[3]||(o[3]=N(s=>!s.shiftKey&&u.sendMessage(),["enter"])),disabled:e.disableChat},{"prepend-inner":p(()=>[d(x,{icon:"",variant:"text",class:"text-medium-emphasis",onClick:e.uploadImage},{default:p(()=>[d(h,{size:"20"})]),_:1},8,["onClick"])]),"append-inner":p(()=>[r.isRunning?(l(),S(x,{key:1,icon:"",variant:"text",class:"text-medium-emphasis"},{default:p(()=>[d(E,{style:{top:"50%"},indeterminate:"",color:"primary"})]),_:1})):(l(),S(x,{key:0,icon:"",variant:"text",type:"submit",onClick:o[1]||(o[1]=s=>u.sendMessage()),class:"text-medium-emphasis",disabled:!r.newMessage},{default:p(()=>[d(m,{width:"24",height:"24",icon:"fluent:document-one-page-sparkle-16-regular"})]),_:1},8,["disabled"]))]),_:1},8,["modelValue","placeholder","disabled"])])])}const De=A(Q,[["render",Ne]]),Fe={mixins:[],name:"Proposals",components:{Proposal:De,AppBaseCard:J,ChatListing:G,ChatProfile:K},data:()=>({prompt:null,definitions:[],processDefinition:null,path:"chats",organizationChart:[],tableData:null,documentQueryStr:null,agentWS:null,isConnection:!1,log:""}),async created(){},mounted(){},methods:{}},Ue={class:"no-scrollbar"};function Je(e,o,t,a,r,u){const m=v("ChatProfile"),g=v("ChatListing"),h=v("Proposal"),s=v("AppBaseCard");return l(),S(F,{elevation:"10"},{default:p(()=>[d(s,null,{leftpart:p(()=>[n("div",Ue,[d(m),d(g)])]),rightpart:p(()=>[d(h,{messages:e.messages,userInfo:e.userInfo,type:e.path,documentQueryStr:e.documentQueryStr,onBeforeReply:e.beforeReply,onSendMessage:e.beforeSendMessage,onSendEditedMessage:e.sendEditedMessage,onStopMessage:e.stopMessage,onGetMoreChat:e.getMoreChat},null,8,["messages","userInfo","type","documentQueryStr","onBeforeReply","onSendMessage","onSendEditedMessage","onStopMessage","onGetMoreChat"])]),mobileLeftContent:p(()=>[d(m),d(g)]),_:1})]),_:1})}const Ze=A(Fe,[["render",Je]]);export{Ze as default};
